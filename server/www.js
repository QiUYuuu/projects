(()=>{var e={9795:(e,t,a)=>{"use strict";a.r(t),a.d(t,{decrypt:()=>r,encrypt:()=>i,getJsApiSignature:()=>o,getSignature:()=>s});const n=require("crypto");function s(e,t,a,s){return(0,n.createHash)("sha1").update([e,t,a,s].sort().join("")).digest("hex")}function r(e,t){const{key:a,iv:s}=l(e),r=(0,n.createDecipheriv)("aes-256-cbc",a,s);r.setAutoPadding(!1);const i=function(e){const t=e[e.length-1];return t<1||t>32?e:e.slice(0,e.length-t)}(Buffer.concat([r.update(t,"base64"),r.final()])),o=i.readUInt32BE(16);return{message:i.slice(20,o+20).toString(),id:i.slice(o+20).toString(),random:i.slice(0,16)}}function i(e,t,a,s=(0,n.randomBytes)(16)){const{key:r,iv:i}=l(e),o=Buffer.from(t),u=Buffer.allocUnsafe(4);u.writeUInt32BE(o.length,0);const c=function(e){const t=32-e.length%32,a=Buffer.allocUnsafe(t);return a.fill(t),Buffer.concat([e,a])}(Buffer.concat([s,u,o,Buffer.from(a)])),d=(0,n.createCipheriv)("aes-256-cbc",r,i);return d.setAutoPadding(!1),Buffer.concat([d.update(c),d.final()]).toString("base64")}function o(e){const{url:t,ticket:a}=e,s=e.nonceStr||Math.random().toString(36).slice(2),r=e.timestamp||Math.floor(Date.now()/1e3);return{timestamp:r,nonceStr:s,signature:(0,n.createHash)("sha1").update(`jsapi_ticket=${a}&noncestr=${s}&timestamp=${r}&url=${t}`).digest("hex")}}function l(e){const t=Buffer.from(`${e}=`,"base64");if(32!==t.length)throw new Error("invalid encodingAESKey");const a=t.slice(0,16);return{key:t,iv:a}}},4279:(e,t,a)=>{const n=a(2127)(),s=a(6725),r=a(479),i=a(2473),o=a(5057),l=a(683),u=a(8328)(o),c=a(3876);n.use(s()),n.use(r(c.corsConfig)),n.use(a(358)(l.secret)),n.use(i.urlencoded({limit:"50mb",extended:!1})),n.use(i.json({limit:"50mb"})),n.use(o({secret:"qwerasdf",resave:!1,saveUninitialized:!0,cookie:{secure:!1,maxAge:36e6},rolling:!0,store:new u({url:"mongodb://10.199.4.22:27017,10.199.4.23:27017,10.199.4.24:27017/yb_session_test?replicaSet=my_repl",touchAfter:86400,databaseName:"yb_session_test",collection:"ldjgsessions"})})),a(925)(n),n.use(((e,t,a)=>{console.log(e.url),console.log(e.method);const n=new Error("Not Found"+e.url+"?");n.status=404,t.json({respCode:"404"}),a(n)})),n.use(((e,t,a)=>{a.locals.message=e.message,a.locals.error="development"===t.app.get("env")?e:{},a.end("error")})),e.exports=n},4151:(e,t,a)=>{const n=a(3908),s=(a(3682)("express:sdr"),a(4271));a(7548).MongoClient;const r=a(3876),i=(a(3690),new n((e=>{s.init().then((()=>{console.log("[SESSION SERVER] has been detected!"),e()})).catch((e=>console.log(e)))}))),o=new n((e=>{const t=r.poolAttrs.connectionString.match(/[^(\/\/)]+:[\d]+(?=\/)/)[0].split(":");a(1631).createConnection(t[1],t[0]).on("connect",(()=>{console.log(`[[ORACLE   SERVER]@${t[1]}:${t[0]} IS STAND BY!`.green),e(1)})).on("error",(a=>{console.log(`[ORACLE SERVER]@${t[1]}:${t[0]} IS DOWN!`.red),e(0)}))}));e.exports=new n((e=>{console.log("#############Detecting Dependency Servers############"),n.all([o,i]).then((()=>{console.log("##########Dependency Server Detect Completely########\n"),e()}))}))},3876:(e,t,a)=>{e.exports={isTest:!1,corsConfig:{origin:["http://192.168.2.208","http://localhost:5900","http://localhost:5900","http://localhost:5905","http://localhost:5600","http://localhost:8100"],methods:["GET","PUT","POST","HEAD","PATCH","DELETE","OPTIONS"],credentials:!0,proxy:!0},nodeServer:{address:"",port:"3001"},CacheClusterUris:["mongodb://10.199.4.22:27017,10.199.4.23:27017,10.199.4.24:27017/yb_session_test?replicaSet=my_repl"],SessionClusterUris:["mongodb://10.199.4.22:27017,10.199.4.23:27017,10.199.4.24:27017/yb_session_test?replicaSet=my_repl"],sessionServer:{uri:["mongodb://10.199.4.22:27017,10.199.4.23:27017,10.199.4.24:27017/yb_session_test?replicaSet=my_repl"],options:{useNewUrlParser:!0}},cacheServer:{uri:["mongodb://10.199.4.22:27017,10.199.4.23:27017,10.199.4.24:27017/yb_session_test?replicaSet=my_repl"],options:{useNewUrlParser:!0,autoIndex:!1,reconnectTries:Number.MAX_VALUE,reconnectInterval:500,poolSize:10,bufferMaxEntries:0}},oracledb:{queueRequests:!0,autoCommit:!1,poolIncrement:1,poolMax:0,poolMin:5,poolPingInterval:60,poolTimeout:60,queueTimeout:0},poolAttrs:{connectionString:"10.199.4.26:1521/orcl",user:"ccsyb",password:"ccsyb",poolIncrement:1,homogeneous:!0},imgs:"data/img/",isDebug:"production"===a(2127)().get("env")}},3159:(e,t,a)=>{const n=a(3876);e.exports={connectionLimit:10,host:n.isTest?"10.199.4.25":"10.199.13.6",user:"u_sjjh",port:n.isTest?"30055":"33333",password:(n.isTest,"SJjh2020)^"),database:"sjjhqzk"}},683:e=>{e.exports={resave:!1,saveUninitialized:!1,rolling:!0,key:"booom",secret:"qwerasdf",cookie:{path:"/",httpOnly:!0,secure:!1,maxAge:6e5}}},4271:(e,t,a)=>{const n=a(3876),s=a(5619),r=a(2243);let i=null,o={};e.exports={init:()=>new Promise(((e,t)=>{const a={useNewUrlParser:!0,useCreateIndex:!0,useFindAndModify:!1,autoIndex:!1,reconnectTries:Number.MAX_VALUE,reconnectInterval:1e3,poolSize:20,bufferMaxEntries:0,connectTimeoutMS:3e4,socketTimeoutMS:36e4,family:4},r=n.CacheClusterUris[0];s.createConnection(r,a).then((t=>{i=t,e()})).catch((e=>t(e)))})),createIndexes:(e,t=null)=>{l(e).createIndexes(r[e].index(t||{expires:1},{expireAfterSeconds:0},{background:!0})).then().catch((e=>{log.writeFile(e,ERR_FILE_NAME),console.error(e)}))},ensureIndexes:(e,t=null)=>{l(e).ensureIndexes(r[e].index(t||{expires:1},{background:!0})).then().catch((e=>{log.writeFile(e,ERR_FILE_NAME),console.error(e)}))},ensureIndexes_ex:(e,t=null,a)=>{l(e).ensureIndexes(r[e].index(t||{expires:1},{expireAfterSeconds:a},{background:!0})).then().catch((e=>{log.writeFile(e,ERR_FILE_NAME),console.error(e)}))},save:(e,t)=>new(l(e))(t).save().then((e=>1)).catch((a=>(log.writeFile(e+"---"+JSON.stringify(t),ERR_FILE_NAME).then((e=>{log.writeFile(a,ERR_FILE_NAME).then()})),-1))),insertMany:async(e,t)=>{try{let a=l(e);return(await a.insertMany(t)).length}catch(t){return log.writeFile(e,ERR_FILE_NAME).then((e=>{log.writeFile(t,ERR_FILE_NAME).then()})),t}},select:(e,t)=>l(e).find(t).then((e=>e)).catch((e=>(log.writeFile(e,ERR_FILE_NAME),[]))),selectTest:(e,t,a)=>l(e).find(t,a).then((e=>e)).catch((e=>(log.writeFile(e,ERR_FILE_NAME),[]))),selectAndSort:(e,t,a={})=>l(e).find(t).sort(a).then((e=>e)).catch((e=>(log.writeFile(e,ERR_FILE_NAME),[]))),selectLastOne:(e,t)=>l(e).find(t).sort({_id:-1}).limit(1).then((e=>e)).catch((e=>(log.writeFile(e,ERR_FILE_NAME),[]))),selectByIdAndUpdate:(e,t,a)=>l(e).findById(t).then((e=>{if(e){for(let t in a)e[t]=a[t];return e.save().then((e=>1)).catch((e=>{throw e}))}return 0})).catch((e=>(log.writeFile(e,ERR_FILE_NAME),-1))),remove:(e,t)=>l(e).remove(t).then((e=>e||0)).catch((e=>(console.error(e),-1))),delete:e=>l(e).deleteMany({}).then((e=>e||0)).catch((e=>(console.error(e),-1))),findOneAndUpdate:(e,t,a)=>l(e).findOneAndUpdate(t,{$set:a},{upsert:!1,new:!0}).then((e=>e?1:0)).catch((e=>(log.writeFile(e,ERR_FILE_NAME),-1))),findOneAndUpdateOrInsert:(e,t,a)=>l(e).findOneAndUpdate(t,{$set:a},{upsert:!0,new:!0}).then((e=>e?1:0)).catch((e=>(log.writeFile(e,ERR_FILE_NAME),-1))),updateMany:(e,t,a)=>l(e).updateMany(t,{$set:a},{upsert:!1,new:!0}).then((e=>e?1:0)).catch((e=>(log.writeFile(e,ERR_FILE_NAME),-1)))};const l=e=>null===i?(log.writeFile(msg.ERR3,ERR_FILE_NAME),console.error(msg.ERR3),null):(o[e]||(o[e]=i.model(e,r[e])),o[e])},3690:(e,t,a)=>{const n=a(366);let s=null;const r=a(3159);e.exports={init:function(){return new Promise(((e,t)=>{s=n.createPool({connectionLimit:10,host:r.host,user:r.user,port:r.port,password:r.password,database:r.database,charset:"utf8mb4"}),e(s)}))},executeProcedure:function(e,t,a){return new Promise(((a,n)=>{null===s&&a(),s.getConnection((function(s,r){if(s)return console.log(s),void n();try{const s=function(e,t){let a="";return a=t&&t.length>0?`CALL ${e}('${t.join("','")}');`:`CALL ${e}();`,a}(e,t);r.query(s,(function(e,t,s){if(r.release(),e)return console.log(e),void n();let i=[];if(t instanceof Array)for(let e=0;e<t.length-1;e++)i.push(t[e]);else a([]);a(i)}))}catch(e){console.log(e),n()}}))}))},inputParamsVal:function(e){return{val:e}},getConnection:function(){return new Promise(((e,t)=>{s.getConnection().then((t=>{e(),function(e){e.release().then((()=>{console.log("connection release")})).catch((e=>{log.writeFile(e,"ERR_FILE_NAME").then()}))}(t)})).catch((e=>t(e)))}))}}},6306:(e,t,a)=>{const n=a(3876),s=a(8054);let r=null;const i=n.oracledb,o=n.poolAttrs;s.fetchAsString=[s.CLOB];for(const e in i)s.key=i.key;function l(){return new Promise(((e,t)=>{s.createPool({user:o.user,password:o.password,connectString:o.connectionString,poolIncrement:10,poolMax:90,poolMin:5,poolTimeout:60,queueTimeout:6e3}).then((t=>{r=t,console.log("[oracle pool] has been created"),e()})).catch((e=>{console.log(e),t(e)}))}))}function u(e){e.close({drop:!0}).then((()=>{console.log("connection closed")})).catch((e=>{log.writeFile(e,ERR_FILE_NAME)}))}l(),e.exports={inputParamsStringCollection:function(e){return{type:s.STRING,dir:s.BIND_IN,val:e}},executeProcedure:function(e,t,a){return new Promise(((n,s)=>{if(null===r)return void s("-4006 连接池对象未初始化");const i=function(e,t,a){let n=[],s={};for(let e in t)n.push(":"+e),s[e]=t[e];for(let e in a)n.push(":"+e),s[e]=a[e];return{plsql:`BEGIN ${e}(${n.join(",")}); END;`,params:s}}(e,t,a);r.getConnection().then((e=>{e.execute(i.plsql,i.params).then((t=>{let r=[];for(let e in a)t.outBinds[e]&&r.push(t.outBinds[e].getRows(1e4));Promise.all(r).then((e=>{n(e)})).then((()=>{let n=[];for(let e in a)n.push(t.outBinds[e].close());Promise.all(n).then((t=>{!function(e){e.release().then((()=>{console.log("connection release")})).catch((e=>{log.writeFile(e,ERR_FILE_NAME)}))}(e)}))})).catch((t=>{console.log(t),u(e),s(t.toString())}))})).catch((t=>{console.error("execute() error",t),t&&t.toString()&&t.toString().indexOf("ORA-04068")>0?r.close(5,(function(e){l().then()})):u(e),s(t.toString())}))})).catch((e=>{console.error("getConnection() error",e),s(e.toString())}))}))},outputParamsCursor:function(e){let t={};for(let a=0;a<e;a++)t["output_"+a]={type:s.CURSOR,dir:s.BIND_OUT};return t},inputParamsVal:function(e){return{val:e}}}},2243:(e,t,a)=>{const n=a(5619).Schema,s=new n({key:String,value:String,expires:Date}),r=new n({code:String,unionid:String,status:String,tel:String,createdAt:{type:Date,expires:30}}),i=new n({creditCode:String,chainName:String}),o=new n({bindId:String,bindName:String}),l=new n({organId:String,organName:String,year:String,January:String,February:String,March:String,April:String,May:String,June:String,July:String,August:String,September:String,October:String,November:String,December:String}),u=new n({_id:String,session:Object,expires:Date}),c=new n({creditCode:String,name:String,address:String,member:String,setDate:String,scope:String,changed:String}),d=new n({creditCode:String,organName:String,pharmacistName:String,pharmacistIDCard:String,status:String}),m=new n({geRenBh:String,jiaTingBh:String,xingMing:String,shenFenZh:String,tel:String,mobile:String,yiBaoBh:String,email:String,canBaoLx:String,canBaoZt:String,canBaoDw:String,danWeiBh:String,empEnttCodg:String,shiYongBz:String,renYuanLbBm:String,renYuanLbMc:String,color1:String,color2:String,zuoFeiBz:String,unionid:String,openid:String,bindId:String,threadId:String,ybUserId:String,workDate:String,insuAdmdvs:String,poolareaNo:String,crtInsuDate:String,psnInsuRltsId:String,selfSign:String,auth_code:String,channel:String,create_time:String,update_time:String,is_delete:String});e.exports={pharmacistInfo:d,qrCodeCcsyb:r,pub_user_info:m,chainCodeInfo:i,bindOrgan:o,voucher:l,ldjgsession:u,sysParams:s,organInfo:c}},925:(e,t,a)=>{e.exports=e=>{e.options("/",((e,t)=>t.status(200).end())),e.get("/",((e,t)=>{t.status(404).end()})),e.use("/ccsyb-system-login",a(4097)),e.use("/ccsyb-shenhe-check",a(1101)),e.use("/ccsyb-qualifications",a(1418)),e.use("/ccsyb-drug",a(6784)),e.use("/ccsyb-form",a(2062)),e.use("/ccsyb-medical",a(5374)),e.use("/ccsyb-binding",a(5033)),e.use("/ccsyb-change",a(7757)),e.use("/ccsyb-test",a(2231))}},1101:(e,t,a)=>{const n=a(2127).Router(null),s=a(6306),r=a(4271),i=a(5172),o=a(8958),l=a(9659),u=a(6172),c=a(5543),d=a(7353),m=a(5747),p=(e,t)=>{t.json({respCode:e})};n.post("/companyInfo",((e,t)=>{const a=e.body.comType,n=e.body.affairs,r="insert"===n?{A:"M_GETMEDICALINFO",B:"M_GETDRUGINFO",C:"GET_QUALIFICATIONS_INFO"}[e.body.comType]:"M_GET_CHANGE_INFO_CHECK",i={};i.creditCode=s.inputParamsVal(String(e.body.creditCode)),i.quarter=s.inputParamsVal(e.body.quarter);const o=["uuid","creditCode","name","address","Region","member","type","level","ownship","businessnature","officeNum","bedNum","onemoNum","area","ybCharge","ybChargeNum","pharmacist","pharmacistIDCard","setDate","licenseKey","lnsurance","dockerH","dockerM","dockerL","nurseH","nurseM","nurseL","meTechH","meTechM","meTechL","applyDate","locationAddress","lat","lng","memberTel","timeLimit","onlyCode","beginBusinessTime","endBusinessTime","organCode","organCountryCode","status","organType","firstNote","secondNote"],l=["uuid","creditCode","address","Region","member","businesspractice","area","ybCharge","ybChargeTel","name","business","setDate","level","pharmacist","pharmacistIDCard","insurance","techH","techM","techL","yingyeNum","applyDate","locationAddress","lat","lng","memberTel","timeLimit","beginBusinessTime","endBusinessTime","status","organType","firstNote","secondNote"],u=["uuid","unionid","idCard","memberName","name","member","phone","applyDate","isChain","chainCode","status","errFiles","note","type"],c=["uuid","id","bindId","beforename","aftername","beforemember","aftermember","beforeaddress","afteraddress","beforearea","afterarea","beforebank","afterbank","beforebankcode","afterbankcode","contacts","contactsphone","techzy","techhigh","techmiddle","techlow","yingyenum","note","changeunit","Region","organCountryCode","status","firstNote","secondNote"];s.executeProcedure(r,i,s.outputParamsCursor(1)).then((e=>{const s=[];e[0].map((e=>{const t={};let r=null;"change"===n?r=c:"A"===a&&"insert"===n?r=o:"B"===a&&"insert"===n?r=l:"C"===a&&(r=u),e.map(((a,n)=>{t[r[n]]=e[n]})),s.push(t)})),t.json({respData:{status:"0"},respResultsets:[s],respCode:"200"})})).catch((e=>{p(e,t)}))})),n.post("/allCompany",((e,t)=>{const a=e.body;let n="";const r={};let i=[];"1"===a.proctype?(n="PROC_GET_USER_LIST",r.type=s.inputParamsVal(a.type),r.region=s.inputParamsVal(a.region),r.searchStr=s.inputParamsVal(a.searchStr),i=["code","organName","member","phone","beginTime","endTime","status"]):(n="PROC_GET_ORGAN_LIST",i=["organType","affairs","no","comName","address","localAddress","code","leagal","leagalTel","applyOrgan","applyPerson","applyPhone","Region","type","beginTime","endTime","score","groupName","lat","lng","status"],r.type=s.inputParamsVal(a.type),r.searchStr=s.inputParamsVal(a.searchStr),r.organ=s.inputParamsVal(a.organ),r.area=s.inputParamsVal("ALL"===a.area?a.areaTotal:a.area),r.score=s.inputParamsVal(1*a.score),r.affairs=s.inputParamsVal(a.affairs),r.organType=s.inputParamsVal(a.organType)),r.pageIndex=s.inputParamsVal(1*a.pageIndex),r.pageSize=s.inputParamsVal(1*a.pageSize),r.quarter=s.inputParamsVal(a.quarter),console.log(r),s.executeProcedure(n,r,s.outputParamsCursor(2)).then((e=>{const n=[];e[0].map((e=>{const t={};e.map(((a,n)=>{t[i[n]]=e[n]})),"1"===a.proctype&&(t.type="C"),n.push(t)})),t.json({respData:{status:1},respResultsets:[n,e[1][0][0]],respCode:"200"})})).catch((e=>{p(e,t)}))})),n.post("/allCompany-review",((e,t)=>{const a=e.body,n={},r=["organType","affairs","no","comName","address","code","leagal","applyOrgan","applyPerson","applyPhone","Region","type","beginTime","endTime","status"];n.type=s.inputParamsVal(a.type),n.searchStr=s.inputParamsVal(a.searchStr),n.organ=s.inputParamsVal(a.organ),n.unionid=s.inputParamsVal(a.unionid),n.area=s.inputParamsVal("ALL"===a.area?a.areaTotal:a.area),n.affairs=s.inputParamsVal(a.affairs),n.organType=s.inputParamsVal(a.organType),n.pageIndex=s.inputParamsVal(1*a.pageIndex),n.pageSize=s.inputParamsVal(1*a.pageSize),n.quarter=s.inputParamsVal(a.quarter),s.executeProcedure("PROC_GET_ORGAN_LIST_REVIEW",n,s.outputParamsCursor(2)).then((e=>{const a=[];e[0].map((e=>{const t={};e.map(((a,n)=>{t[r[n]]=e[n]})),a.push(t)})),t.json({respData:{status:1},respResultsets:[a,e[1][0][0]],respCode:"200"})})).catch((e=>{p(e,t)}))})),n.post("/allCompany-score",((e,t)=>{const a=e.body,n={},r=["organType","affairs","no","comName","code","address","leagal","Region","type","beginTime","endTime","score","assessTime","assessPerson","expertgroup","assessNote","groupName","lat","lng","status"];n.type=s.inputParamsVal(a.type),n.affairs=s.inputParamsVal(a.affairs),n.searchStr=s.inputParamsVal(a.searchStr),n.organ=s.inputParamsVal(a.organ),n.area=s.inputParamsVal("ALL"===a.area?a.areaTotal:a.area),n.score=s.inputParamsVal(a.score),n.pageIndex=s.inputParamsVal(1*a.pageIndex),n.pageSize=s.inputParamsVal(1*a.pageSize),n.quarter=s.inputParamsVal(a.quarter),s.executeProcedure("M_GET_ASSESSLIST",n,s.outputParamsCursor(2)).then((e=>{const a=[];e[0].map((e=>{const t={};e.map(((a,n)=>{t[r[n]]=e[n]})),a.push(t)})),t.json({respData:{status:1},respResultsets:[a,e[1][0][0]],respCode:"200"})})).catch((e=>{p(e,t)}))})),n.post("/setResult",((e,t)=>{const a={};a.code=s.inputParamsVal(String(e.body.code)),a.state=s.inputParamsVal(String(e.body.state)),a.reason=s.inputParamsVal(String(e.body.reason)),a.note=s.inputParamsVal(String(e.body.note)),a.admin=s.inputParamsVal(String(e.body.admin)),a.checkType=s.inputParamsVal(String(e.body.checkType)),a.quarter=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_SETSTATE",a,s.outputParamsCursor(1)).then((async a=>{t.json({respData:{status:"0"},respResultsets:a[0],respCode:"200"}),u(e.body.uuid,e.body.checkType,e.body.name,e.body.state)})).catch((e=>{p(e,t)}))})),n.post("/checkAll",((e,t)=>{const a={};a.str=s.inputParamsVal(e.body.selectString),a.admin=s.inputParamsVal(e.body.admin),a.quarter=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_SETALL",a,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{p(e,t)}))})),n.post("/setResult-review",((e,t)=>{const a={};a.code=s.inputParamsVal(String(e.body.code)),a.state=s.inputParamsVal(String(e.body.state)),a.note=s.inputParamsVal(String(e.body.note)),a.admin=s.inputParamsVal(String(e.body.admin)),a.reason=s.inputParamsVal(String(e.body.reason)),a.quarter=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_SETRESULT_REVIEW",a,s.outputParamsCursor(1)).then((a=>{t.json({respData:{status:"0"},respResultsets:a[0],respCode:"200"}),u(e.body.uuid,e.body.checkType,e.body.name,e.body.state)})).catch((e=>{p(e,t)}))})),n.post("/organList",((e,t)=>{const a=["creditCode","name","type","beginTime","status","note","reviewNote","errFiles","endTime"],n={};n.id=s.inputParamsVal(String(e.body.id)),n.type=s.inputParamsVal(String(e.body.type)),n.status=s.inputParamsVal(String(e.body.status)),n.quarter=s.inputParamsVal(e.body.quarter),s.executeProcedure("GET_REGISTER_POINTS",n,s.outputParamsCursor(1)).then((e=>{console.log(e);let n=[];e[0].map((e=>{const t={};e.map(((n,s)=>{t[a[s]]=e[s]||""})),n.push(t)})),t.json({respData:{status:"0"},respResultsets:n,respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/getImgList",((e,t)=>{const a=e.body,n="C"===a.type?"GET_QUALIFICATION_IMG":"GET_ORGAN_IMG",r={};r.id=s.inputParamsVal(e.body.id),r.type=s.inputParamsVal(e.body.unit),r.quarter=s.inputParamsVal(a.quarter),s.executeProcedure(n,r,s.outputParamsCursor(1)).then((e=>{const a=[];e[0].map((e=>{a.push({no:e[0],unit:e[1],status:!0,note:""})})),console.log(a),t.json({respData:{status:"0"},respResultsets:a,respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/getQAList",((e,t)=>{const a=e.body,n={};n.id=s.inputParamsVal(e.body.id),n.type=s.inputParamsVal(e.body.unit),n.quarter=s.inputParamsVal(a.quarter),s.executeProcedure("GET_QUALIFICATION_IMG",n,s.outputParamsCursor(1)).then((e=>{const n=[];e[0].map((e=>{n.push("C"===a.type?e[0]:{no:e[0],unit:e[1],status:!0,note:""})})),t.json({respData:{status:"0"},respResultsets:n,respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/getimgData",((e,t)=>{const a={};a.no=s.inputParamsVal(e.body.fileNo),a.type=s.inputParamsVal(e.body.type),a.quarter=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_GET_IMGDATA",a,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{p(e,t)}))})),n.post("/set_group",((e,t)=>{const a={};a.code=s.inputParamsVal(e.body.codeString),a.groupName=s.inputParamsVal(e.body.groupName),a.batch=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_SET_ORGANGROUP",a,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{p(err,t)}))})),n.post("/setCode",((e,t)=>{const a={};a.code=s.inputParamsVal(e.body.code),a.time=s.inputParamsVal(e.body.time),a.person=s.inputParamsVal(e.body.person),a.score=s.inputParamsVal(1*e.body.score),a.expertGroup=s.inputParamsVal(e.body.assessExpertGroup),a.note=s.inputParamsVal(e.body.note),a.batch=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_SET_SCORE",a,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{p(err,t)}))})),n.post("/getScoreLevel",((e,t)=>{const a=["score","type","affairs"],n={};n.area=s.inputParamsVal(e.body.area),n.type=s.inputParamsVal(e.body.type),n.affairs=s.inputParamsVal(e.body.affairs),n.batch=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_GET_SCORELEVEL",n,s.outputParamsCursor(1)).then((e=>{let n=[];e[0].map((e=>{const t={};e.map(((n,s)=>{t[a[s]]=e[s]})),n.push(t)})),t.json({respData:{status:"0"},respResultsets:[n],respCode:"200"})})).catch((e=>{p(err,t)}))})),n.post("/downLoad",(function(e,t,a){let n=e.query;patient.downLoad(n).then((e=>{let a=e.file_path,n=syspath.join(properties.path,a),s=m.statSync(n).size,r=m.createReadStream(n);t.writeHead(200,{"Content-Type":"application/force-download","Content-Disposition":"attachment; filename="+d(e.file_name),"Content-Length":s}),r.pipe(t)})).catch((e=>{console.log(e),t.json(myBase.outputError(e))}))})),n.post("/downLoadWord",((e,t)=>{const a=e.body,n=a.comType,r={A:"M_GETMEDICALINFO",B:"M_GETDRUGINFO"}[a.comType],o={};o.creditCode=s.inputParamsVal(String(a.creditCode)),o.quarter=s.inputParamsVal(a.quarter),s.executeProcedure(r,o,s.outputParamsCursor(1)).then((e=>{const s=i(n,a.creditCode,"申请表",e[0][0]);t.json({respData:{status:"0"},respResultsets:[s],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/downLoadImg",((e,t)=>{const a=e.body,n={};n.creditCode=s.inputParamsVal(a.code),n.quarter=s.inputParamsVal(a.quarter),s.executeProcedure("M_GET_ALLIMG",n,s.outputParamsCursor(2)).then((async e=>{const n=[],s=e[1][0][0];e[0].map((e=>{n.push({fileId:e[0],fileUnit:e[1],fileNo:e[2]})}));const r=await o(s,a.quarter,n);t.json({respData:{status:"0"},respResultsets:[r],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.get("/zip",((e,t)=>{l.zipDownload(e,t,!0)})),n.get("/archiver",((e,t)=>{let a=m.createWriteStream(process.cwd()+"/package.zip"),n=c("zip",{zlib:{level:9}});a.on("close",(function(){console.log(`总共 ${n.pointer()} 字节`),console.log("archiver完成文件的归档，文件输出流描述符已关闭"),setTimeout((()=>{console.log("---------DOWNLOAD START---------")}),1e3)})),a.on("end",(function(){console.log("数据源已耗尽")})),n.on("warning",(function(e){if("ENOENT"!==e.code)throw e;console.warn("stat故障和其他非阻塞错误")})),n.on("error",(function(e){throw e})),n.pipe(a),n.directory(`${process.cwd()}/pdfs`,"package"),n.finalize()})),n.post("/pass",((e,t)=>{const a=e.body,n={};n.score=s.inputParamsVal(a.score),n.type=s.inputParamsVal(a.type),n.area=s.inputParamsVal(a.area),n.affairs=s.inputParamsVal(a.affairs),n.quarter=s.inputParamsVal(a.quarter),s.executeProcedure("M_ORGAN_PASS",n,s.outputParamsCursor(2)).then((e=>{console.log(e);const a=[],n=["name","no","address"];e[1].map((e=>{const t={};e.map(((a,s)=>{t[n[s]]=e[s]})),a.push(t)})),t.json({respData:{status:"0"},respResultsets:[e[0][0],a],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/sendMsg",(async(e,t)=>{console.log(e.body.code.toLowerCase());const a=new RegExp(`^${e.body.code.toLowerCase()}$`,"i"),n=await r.select("userInfo",{unionid:{$regex:a}});n[0].openid,t.json(n)})),e.exports=n},5033:(e,t,a)=>{const n=a(2127).Router(null),s=a(6306),r=a(4271),{v1:i}=a(1231),o=(e,t)=>{t.json({error:e})};n.post("/bindDrug",((e,t)=>{const a=e.body,n={};n.name=s.inputParamsVal(a.name),n.addres=s.inputParamsVal(a.address),n.Region=s.inputParamsVal(a.Region),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(a.lat),n.lng=s.inputParamsVal(a.lng),n.creditcode=s.inputParamsVal(a.creditCode),n.organID=s.inputParamsVal(a.bindID),n.business=s.inputParamsVal(a.business),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.floorSpace=s.inputParamsVal(a.floorSpace),n.businessPractice=s.inputParamsVal(a.businessPractice),n.level=s.inputParamsVal(a.level),n.member=s.inputParamsVal(a.member),n.memberTel=s.inputParamsVal(a.memberTel),n.pharmacist=s.inputParamsVal(a.pharmacist),n.pharmacistIdcard=s.inputParamsVal(a.YSIdcard),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.Insurance=s.inputParamsVal(a.Insurance),n.techHigh=s.inputParamsVal(a.techHigh),n.techmiddle=s.inputParamsVal(a.techmiddle),n.techLow=s.inputParamsVal(a.techLow),n.yingyeNum=s.inputParamsVal(a.yingyeNum),n.unionid=s.inputParamsVal(a.unionid),n.bank=s.inputParamsVal(a.bank),n.bankCode=s.inputParamsVal(a.bankCode),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.softName=s.inputParamsVal(a.SoftwareISPName),n.softBegin=s.inputParamsVal(a.SoftwareISPBeginTime),n.softEnd=s.inputParamsVal(a.SoftwareISPEndTime),n.netName=s.inputParamsVal(a.NetWorkISPName),n.netBegin=s.inputParamsVal(a.NetWorkISPBeginTime),n.netEnd=s.inputParamsVal(a.NetWorkISPEndTime),n.organType=s.inputParamsVal(a.manageType),s.executeProcedure("M_BINDING_DRUG",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{o(e,t)}))})),n.post("/bindMedical",((e,t)=>{const a=e.body,n={};n.creditcode=s.inputParamsVal(a.creditCode),n.name=s.inputParamsVal(a.name),n.address=s.inputParamsVal(a.address),n.member=s.inputParamsVal(a.member),n.type=s.inputParamsVal(a.type),n.level=s.inputParamsVal(a.level),n.ownShip=s.inputParamsVal(a.ownership),n.businessNature=s.inputParamsVal(a.businessNature),n.officeNum=s.inputParamsVal(a.officeNumber),n.bedNum=s.inputParamsVal(a.bedNumber),n.area=s.inputParamsVal(a.floorSpace),n.ybCharge=s.inputParamsVal(a.yibaoCharge),n.ybChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.setDate=s.inputParamsVal(a.setDate),n.licenseKey=s.inputParamsVal(a.licensKey),n.Insurance=s.inputParamsVal(a.Insurance),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(1*a.lat),n.lng=s.inputParamsVal(1*a.lng),n.memberTel=s.inputParamsVal(a.memberTel),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.onlyCode=s.inputParamsVal(a.onlyCode),n.onemoNum=s.inputParamsVal(a.oenmoNumber),n.region=s.inputParamsVal(a.Region),n.batch=s.inputParamsVal(a.quarter),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.physician=s.inputParamsVal(a.physician),n.YSIdcard=s.inputParamsVal(a.YSIdcard),n.organID=s.inputParamsVal(a.bindID),n.bank=s.inputParamsVal(a.bank),n.bankCode=s.inputParamsVal(a.bankCode),n.dockerHigh=s.inputParamsVal(a.dockerHigh),n.dockermiddle=s.inputParamsVal(a.dockermiddle),n.dockerLow=s.inputParamsVal(a.dockerLow),n.nurseHigh=s.inputParamsVal(a.nurseHigh),n.nursemiddle=s.inputParamsVal(a.nursemiddle),n.nurseLow=s.inputParamsVal(a.nurseLow),n.MedicalTechniciansHigh=s.inputParamsVal(a.MedicalTechniciansHigh),n.MedicalTechniciansmiddle=s.inputParamsVal(a.MedicalTechniciansmiddle),n.MedicalTechniciansLow=s.inputParamsVal(a.MedicalTechniciansLow),n.softName=s.inputParamsVal(a.SoftwareISPName),n.softBegin=s.inputParamsVal(a.SoftwareISPBeginTime),n.softEnd=s.inputParamsVal(a.SoftwareISPEndTime),n.netName=s.inputParamsVal(a.NetWorkISPName),n.netBegin=s.inputParamsVal(a.NetWorkISPBeginTime),n.netEnd=s.inputParamsVal(a.NetWorkISPEndTime),n.unionid=s.inputParamsVal(a.unionid),n.organType=s.inputParamsVal(a.manageType),s.executeProcedure("M_BINDING_MEDICAL",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{o(e,t)}))})),n.post("/getUuid",((e,t)=>{const a="ccsyb-binding-"+i();t.json({respData:{status:"0"},respResultsets:[a],respCode:"200"})})),n.post("/get-info",(async(e,t)=>{const a=await r.select("qrCodeCcsyb",{code:e.body.code});if(a.length>0)if("1"==a[0].status){const e={},n=await r.select("userInfo",{unionid:a[0].unionid,selfSign:"1"}).then();e.cardNo=s.inputParamsVal(n[0].shenFenZh);const i={};i.name=n[0].xingMing,i.phone=a[0].tel,i.IDCard=n[0].shenFenZh,i.status="1",i.msg="success",t.json(i)}else t.json("111");else t.json("111")})),n.post("/get-bind-list",((e,t)=>{const a=e.body,n=["code","creditCode","name","address","dz","dzTel","bindDate"],r={};r.unionId=s.inputParamsVal(a.unionId),r.type=s.inputParamsVal(a.type),s.executeProcedure("M_GET_BIND_ORGAN",r,s.outputParamsCursor(1)).then((e=>{const a=[];e[0].map((e=>{const t={};e.map(((a,s)=>{t[n[s]]=e[s]})),a.push(t)})),t.json({respData:{status:"0"},respResultsets:[a],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/get-bindOrgan-info",((e,t)=>{const a=["code","creditCode","name","address","dz","dzTel","localAddress","union","bindDate","dzUnionid","openTime","closeTime","clerk"],n={};n.creditCode=s.inputParamsVal(e.body.creditCode),s.executeProcedure("PROC_GET_BIND_ORGAN_INFO",n,s.outputParamsCursor(1)).then((e=>{const n=[];e[0].map((e=>{const t={};e.map(((n,s)=>{t[a[s]]=e[s]})),n.push(t)})),t.json({respData:{status:"0"},respResultsets:n,respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/delete-bind-organ",((e,t)=>{const a=e.body,n={};n.unionId=s.inputParamsVal(a.unionId),n.bindId=s.inputParamsVal(a.bindId),n.type=s.inputParamsVal(a.type),s.executeProcedure("M_DELETE_BIND_ORGAN",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0][0],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/get-voucher-list",(async(e,t)=>{const a=e.body,n={};n.unionId=s.inputParamsVal(a.unionId),n.type=s.inputParamsVal(a.type),n.area=s.inputParamsVal(a.area),n.batch=s.inputParamsVal(a.quarter),n.pageIndex=s.inputParamsVal(1*a.pageIndex),n.pageSize=s.inputParamsVal(1*a.pageSize);const i=await s.executeProcedure("M_GET_BIND_ORGAN1",n,s.outputParamsCursor(2)),o=[];i[0].map((async e=>{const t=await r.select("voucher",{organId:e[4],year:a.year});o.push(t[0])})),setTimeout((()=>{t.json({respData:{status:"0"},respResultsets:[o,i[1][0][0]],respCode:"200"})}),300)})),n.post("/compareInfo",(async(e,t)=>{const a=await r.select("bindOrgan",{bindId:e.body.id}).then();t.json(a)})),n.post("/get-change-list",((e,t)=>{const a=e.body,n=["name","code","address","member","bindId","rigion","bank","bankCode","memberTel","bindTime","organType","business","area","type","businessNature","licensKey","beginTime","status"],r={};r.unionId=s.inputParamsVal(a.unionId),r.type=s.inputParamsVal(a.type),r.area=s.inputParamsVal(a.area),r.batch=s.inputParamsVal(a.quarter),s.executeProcedure("M_GET_CHANGE_LIST",r,s.outputParamsCursor(1)).then((e=>{const a=[];e[0].map((e=>{const t={};e.map(((a,s)=>{t[n[s]]=e[s]})),a.push(t)})),t.json({respData:{status:"0"},respResultsets:[a],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/get-changed-list",((e,t)=>{const a=e.body,n=["code","name","type","beginTime","status","region","member","note","reviewNote","unit"],r={};r.unionId=s.inputParamsVal(a.unionId),r.type=s.inputParamsVal(a.type),r.area=s.inputParamsVal(a.area),r.status=s.inputParamsVal(a.status),r.batch=s.inputParamsVal(a.quarter),s.executeProcedure("M_GET_CHANGED_LIST",r,s.outputParamsCursor(1)).then((e=>{const a=[];e[0].map((e=>{const t={};e.map(((a,s)=>{t[n[s]]=e[s]})),a.push(t)})),t.json({respData:{status:"0"},respResultsets:[a],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/update-form",((e,t)=>{const a=e.body,n={};n.creditCode=s.inputParamsVal(a.creditCode),n.locationAddress=s.inputParamsVal(a.locationAddress),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.clerk=s.inputParamsVal(a.clerk),s.executeProcedure("PROC_UPDATE_FORM",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})}))})),e.exports=n},6784:(e,t,a)=>{const n=a(2127).Router(null),s=a(6306),r=a(4271),{v1:i}=(a(9659),a(1231)),o=(e,t)=>{t.json({error:e})};n.post("/form",((e,t)=>{const a=e.body,n={},i="base"===a.organType?a.creditCode:`${a.creditCode}-T`;n.name=s.inputParamsVal(a.name),n.addres=s.inputParamsVal(a.address),n.Region=s.inputParamsVal(a.Region),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(a.lat),n.lng=s.inputParamsVal(a.lng),n.creditcode=s.inputParamsVal(i),n.business=s.inputParamsVal(a.business),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.floorSpace=s.inputParamsVal(a.floorSpace),n.businessPractice=s.inputParamsVal(a.businessPractice),n.level=s.inputParamsVal(a.level),n.member=s.inputParamsVal(a.member),n.memberTel=s.inputParamsVal(a.memberTel),n.pharmacist=s.inputParamsVal(a.pharmacist),n.pharmacistIdcard=s.inputParamsVal(a.YSIdcard||"-"),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.Insurance=s.inputParamsVal(a.Insurance),n.techHigh=s.inputParamsVal(a.techHigh),n.techmiddle=s.inputParamsVal(a.techmiddle),n.techLow=s.inputParamsVal(a.techLow),n.yingyeNum=s.inputParamsVal(a.yingyeNum),n.unionid=s.inputParamsVal(a.unionid),n.quarter=s.inputParamsVal(a.quarter),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.organType=s.inputParamsVal(a.organType),s.executeProcedure("ADDDRUGFORM",n,s.outputParamsCursor(1)).then((e=>{const n={creditCode:i,organName:a.name,pharmacistName:a.pharmacist,pharmacistIDCard:a.YSIdcard||"-",status:"0"};r.findOneAndUpdateOrInsert("pharmacistInfo",{creditCode:i},n),t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{o(e,t)}))})),n.post("/updateForm",((e,t)=>{const a=e.body,n={};n.name=s.inputParamsVal(a.name),n.addres=s.inputParamsVal(a.address),n.Region=s.inputParamsVal(a.Region),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(a.lat),n.lng=s.inputParamsVal(a.lng),n.creditcode=s.inputParamsVal(a.creditCode),n.business=s.inputParamsVal(a.business),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.floorSpace=s.inputParamsVal(a.floorSpace),n.businessPractice=s.inputParamsVal(a.businessPractice),n.level=s.inputParamsVal(a.level),n.member=s.inputParamsVal(a.member),n.memberTel=s.inputParamsVal(a.memberTel),n.pharmacist=s.inputParamsVal(a.pharmacist),n.pharmacistIdcard=s.inputParamsVal(a.YSIdcard||"-"),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.Insurance=s.inputParamsVal(a.Insurance),n.techHigh=s.inputParamsVal(a.techHigh),n.techmiddle=s.inputParamsVal(a.techmiddle),n.techLow=s.inputParamsVal(a.techLow),n.yingyeNum=s.inputParamsVal(a.yingyeNum),n.unionid=s.inputParamsVal(a.unionid),n.quarter=s.inputParamsVal(a.quarter),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),s.executeProcedure("M_UPDATE_DRUG_FORM",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{o(e,t)}))})),n.post("/getUuid",((e,t)=>{const a="ccsyb-"+e.body.type+"-drug-"+i();t.json({respData:{status:"0"},respResultsets:[a],respCode:"200"})})),n.post("/get-info",(async(e,t)=>{const a=await r.select("qrCodeCcsyb",{code:e.body.code});if(a.length>0)if("1"==a[0].status){const e={},n=await r.select("userInfo",{unionid:a[0].unionid,selfSign:"1"}).then();e.cardNo=s.inputParamsVal(n[0].shenFenZh);const i={};i.name=n[0].xingMing,i.phone=a[0].tel,i.IDCard=n[0].shenFenZh,i.status="1",i.msg="success",t.json(i)}else t.json("111");else t.json("111")})),e.exports=n},2062:(e,t,a)=>{const n=a(2127).Router(null),s=a(6306),r=(a(3690),a(4271)),i=a(3876),o=a(8633),l=a(5747),u=(a(9953),a(1671)),c=(a(5622),a(9659),a(204)),d=(e,t)=>{t.json({error:e})};let m=o({dest:i.imgs});n.get("/test",((e,t)=>{t.json("test router")})),n.post("/uploadimg",m.single("file"),(function(e,t,a){const n=e.body;if(0!==e.file.length){let a=e.file,r=l.readFileSync(a.destination+a.filename);const i=new Buffer(r).toString("base64");let o="data:"+u.lookup(a.destination+a.filename)+";base64,"+i;const c={creditCode:n.code,no:n.code+n.no,name:n.name,mimetype:a.mimetype,file:n.code+n.name,note:"",status:"1"},m="M_SETIMG",p={},g="base"===n.organType?n.code:n.code+"-T";p.code=s.inputParamsVal(g+n.timestamp+n.name+n.no),p.name=s.inputParamsVal(n.name),p.file=s.inputParamsVal(o),p.note=s.inputParamsVal(""),p.status=s.inputParamsVal("0"),p.fileType=s.inputParamsVal(a.mimetype),p.fileCreditcode=s.inputParamsVal(g),p.timestamp=s.inputParamsVal(n.timestamp),p.no=s.inputParamsVal(1*n.no),p.sortIndex=s.inputParamsVal(1*n.sortIndex),p.quarter=s.inputParamsVal(n.quarter),s.executeProcedure(m,p,s.outputParamsCursor(1)).then((e=>{"1"===e[0][0][0]&&t.json({respData:{status:1},respResultsets:[c],respCode:"200"})})).catch((e=>{d(e,t)}))}else t.render("error",{message:"上传文件不能为空！"})})),n.post("/setForm",((e,t)=>{const a=e.body,n={};n.code=s.inputParamsVal("base"===a.organType?a.creditcode:a.creditcode+"-T"),n.timestamp=s.inputParamsVal(a.timestamp),n.fileNos=s.inputParamsVal(a.fileNo),n.quarter=s.inputParamsVal(a.quarter),s.executeProcedure("M_SETFORM",n,s.outputParamsCursor(1)).then((e=>{"1"===e[0][0][1]&&r.findOneAndUpdate("pharmacistInfo",{creditCode:"base"===a.organType?a.creditcode:a.creditcode+"-T"},{status:"1"}),t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{d(e,t)}))})),n.post("/secondForm",((e,t)=>{const a={};a.code=s.inputParamsVal(String(e.body.creditCode)),a.timestamp=s.inputParamsVal(String(e.body.timestamp)),a.fileNos=s.inputParamsVal(e.body.fileNo),a.state=s.inputParamsVal(e.body.state),a.quarter=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_SECONDFORM",a,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{d(e,t)}))})),n.post("/organList",((e,t)=>{const a=["creditCode","name","type","beginTime","status","note","reviewNote","errFiles","endTime","affairs"],n={};n.id=s.inputParamsVal(String(e.body.id)),n.affairs=s.inputParamsVal(String(e.body.affairs)),n.status=s.inputParamsVal(String(e.body.status)),n.quarter=s.inputParamsVal(e.body.quarter),s.executeProcedure("GET_REGISTER_POINTS",n,s.outputParamsCursor(1)).then((e=>{let n=[];e[0].map((e=>{const t={};e.map(((n,s)=>{t[a[s]]=e[s]||""})),n.push(t)})),t.json({respData:{status:"0"},respResultsets:n,respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/companyInfo",((e,t)=>{const a=e.body.comType,n={A:"M_GETMEDICALINFO",B:"M_GETDRUGINFO",C:"GET_QUALIFICATIONS_INFO"}[e.body.comType],r={};r.creditCode=s.inputParamsVal(String(e.body.creditCode)),r.quarter=s.inputParamsVal(e.body.quarter);const i=["uuid","creditCode","name","address","Region","member","type","level","ownship","businessnature","officeNum","bedNum","onemoNum","area","ybCharge","ybChargeNum","pharmacist","pharmacistIDCard","setDate","licenseKey","lnsurance","dockerH","dockerM","dockerL","nurseH","nurseM","nurseL","meTechH","meTechM","meTechL","applyDate","locationAddress","lat","lng","memberTel","timeLimit","onlyCode","beginBusinessTime","endBusinessTime","organCode","organCountryCode","status","organType"],o=["uuid","creditCode","address","Region","member","businesspractice","area","ybCharge","ybChargeTel","name","business","setDate","level","pharmacist","pharmacistIDCard","insurance","techH","techM","techL","yingyeNum","applyDate","locationAddress","lat","lng","memberTel","timeLimit","beginBusinessTime","endBusinessTime","status","organType"],l=["uuid","unionid","idCard","memberName","name","member","phone","applyDate","isChain","chainCode","status","errFiles","note","type"];s.executeProcedure(n,r,s.outputParamsCursor(1)).then((e=>{const n=[];e[0].map((e=>{const t={};let s=null;s="A"===a?i:"B"===a?o:l,e.map(((a,n)=>{t[s[n]]=e[n]})),n.push(t)})),t.json({respData:{status:"0"},respResultsets:[n],respCode:"200"})})).catch((e=>{d(e,t)}))})),n.post("/get-link-list",((e,t)=>{const a=e.body,n={},r=["unionId","organName","affairs","type","region","userName","userPhone","beginTime","status"];n.unionid=s.inputParamsVal(a.unionid),n.region=s.inputParamsVal(a.region),n.type=s.inputParamsVal(a.type),n.status=s.inputParamsVal(a.status),n.affairs=s.inputParamsVal(a.affairs),n.searchStr=s.inputParamsVal(a.searchStr),n.quarter=s.inputParamsVal(a.quarter),s.executeProcedure("M_GET_LINKED_LIST",n,s.outputParamsCursor(1)).then((e=>{const a=[];console.log(e[0].length),e[0].map((e=>{const t={};e.map(((a,n)=>{t[r[n]]=e[n]})),a.push(t)})),t.json({respData:{status:"0"},respResultsets:[a],respCode:"200"})})).catch((e=>{d(e,t)}))})),n.post("/getInfo",(async(e,t)=>{r.select("organInfo",{creditCode:e.body.creditCode}).then((e=>{t.json({respData:{status:"0"},respResultsets:e,respCode:"200"})}))})),n.post("/uploadInfo",((e,t)=>{const a=e.body,n={creditCode:a.creditCode,name:a.name,address:a.address,setDate:a.setDate,changed:"1"};r.findOneAndUpdateOrInsert("organInfo",{creditCode:a.creditCode},n).then((e=>{t.json({respData:{status:"0"},respResultsets:["1"],respCode:"200"})}))})),n.post("/bind-organ",((e,t)=>{const a=e.body,n={};n.code=s.inputParamsVal(a.code),n.creditCode=s.inputParamsVal(a.creditCode),n.name=s.inputParamsVal(a.name),n.address=s.inputParamsVal(a.address),n.dz=s.inputParamsVal(a.dz),n.dzTel=s.inputParamsVal(a.dzTel),n.unionId=s.inputParamsVal(a.unionId),n.dzUnionId=s.inputParamsVal(a.dzUnionid),s.executeProcedure("PROC_INSERT_BIND_ORGAN",n,s.outputParamsCursor(1)).then((e=>{e&&t.json({respData:{status:"0"},respResultsets:"1",respCode:"200"})}))})),n.post("/add-order",((e,t)=>{const a=e.body,n={};n.orderNo=c(a.time+a.creditCode),n.creditCode=s.inputParamsVal(a.creditCode),n.title=s.inputParamsVal(a.title),n.note=s.inputParamsVal(a.note),n.concat=s.inputParamsVal(a.contact),n.tel=s.inputParamsVal(a.tel),n.unionId=s.inputParamsVal(a.unionId),n.batch=s.inputParamsVal(a.batch),n.timestamp=s.inputParamsVal(a.timestamp),s.executeProcedure("PROC_ADD_ORDER",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})}))})),e.exports=n},7757:(e,t,a)=>{const n=a(2127).Router(null),s=a(6306),{v1:r}=(a(4271),a(9659),a(204),a(1231));n.post("/drugChange",((e,t)=>{const a=e.body,n={};n.id=s.inputParamsVal(a.bindId),n.bindId=s.inputParamsVal(a.bindId),n.beforeName=s.inputParamsVal(a.beforeName||"-"),n.afterName=s.inputParamsVal(a.afterName),n.beforeMember=s.inputParamsVal(a.beforeMember||"-"),n.afterMember=s.inputParamsVal(a.afterMember),n.beforeAddress=s.inputParamsVal(a.beforeAddress||"-"),n.afterAddress=s.inputParamsVal(a.afterAddress),n.beforeArea=s.inputParamsVal(a.beforeArea||"-"),n.afterArea=s.inputParamsVal(a.afterArea),n.beforeLevel=s.inputParamsVal("-"),n.afterLevel=s.inputParamsVal("-"),n.beforeNature=s.inputParamsVal("-"),n.afterNature=s.inputParamsVal("-"),n.beforeType=s.inputParamsVal("-"),n.afterType=s.inputParamsVal("-"),n.beforeLicenseLey=s.inputParamsVal(a.beforeLicenseLey||"-"),n.afterLicenseLey=s.inputParamsVal(a.afterLicenseLey||"-"),n.beforeBank=s.inputParamsVal(a.beforeBank||"-"),n.afterBank=s.inputParamsVal(a.afterBank),n.beforeBanKCode=s.inputParamsVal(a.beforeBanKCode||"-"),n.afterBankCode=s.inputParamsVal(a.afterBankCode),n.contacts=s.inputParamsVal(a.contacts),n.contactsPhone=s.inputParamsVal(a.contactsPhone),n.techZy=s.inputParamsVal("-"),n.techHigh=s.inputParamsVal(a.techHigh),n.techmiddle=s.inputParamsVal(a.techmiddle),n.techLow=s.inputParamsVal(a.techLow),n.yingyeNum=s.inputParamsVal(a.yingyeNum),n.note=s.inputParamsVal(a.note),n.unionid=s.inputParamsVal(a.unionid),n.manageType=s.inputParamsVal(a.manageType),n.changeUnit=s.inputParamsVal(a.changeUnit),n.Region=s.inputParamsVal(a.Region),n.batch=s.inputParamsVal(a.quarter),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(1*a.lat),n.lng=s.inputParamsVal(1*a.lng),n.creditcode=s.inputParamsVal(a.creditCode),n.business=s.inputParamsVal(a.business),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.businessPractice=s.inputParamsVal(a.businessPractice),n.level=s.inputParamsVal(a.level),n.memberTel=s.inputParamsVal(a.memberTel),n.pharmacist=s.inputParamsVal(a.pharmacist),n.pharmacistIdcard=s.inputParamsVal(a.YSIdcard),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.Insurance=s.inputParamsVal(a.Insurance),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.softName=s.inputParamsVal(a.SoftwareISPName),n.softBegin=s.inputParamsVal(a.SoftwareISPBeginTime),n.softEnd=s.inputParamsVal(a.SoftwareISPEndTime),n.netName=s.inputParamsVal(a.NetWorkISPName),n.netBegin=s.inputParamsVal(a.NetWorkISPBeginTime),n.netEnd=s.inputParamsVal(a.NetWorkISPEndTime),n.type=s.inputParamsVal("-"),n.ownShip=s.inputParamsVal("-"),n.businessNature=s.inputParamsVal("-"),n.officeNum=s.inputParamsVal("-"),n.bedNum=s.inputParamsVal(0),n.area=s.inputParamsVal(0),n.licenseKey=s.inputParamsVal("-"),n.onlyCode=s.inputParamsVal("-"),n.onemoNum=s.inputParamsVal(0),n.dockerHigh=s.inputParamsVal(0),n.dockermiddle=s.inputParamsVal(0),n.dockerLow=s.inputParamsVal(0),n.nurseHigh=s.inputParamsVal(0),n.nursemiddle=s.inputParamsVal(0),n.nurseLow=s.inputParamsVal(0),n.MedicalTechniciansHigh=s.inputParamsVal(0),n.MedicalTechniciansmiddle=s.inputParamsVal(0),n.MedicalTechniciansLow=s.inputParamsVal(0),n.organCountryCode=s.inputParamsVal(a.organCountryCode||"-"),s.executeProcedure("M_INFO_CHANGE",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/medicalChange",((e,t)=>{const a=e.body,n={};n.id=s.inputParamsVal(a.bindId),n.bindId=s.inputParamsVal(a.bindId),n.beforeName=s.inputParamsVal(a.beforeName||"-"),n.afterName=s.inputParamsVal(a.afterName),n.beforeMember=s.inputParamsVal(a.beforeMember||"-"),n.afterMember=s.inputParamsVal(a.afterMember),n.beforeAddress=s.inputParamsVal(a.beforeAddress||"-"),n.afterAddress=s.inputParamsVal(a.afterAddress),n.beforeArea=s.inputParamsVal("-"),n.afterArea=s.inputParamsVal("-"),n.beforeLevel=s.inputParamsVal("-"),n.afterLevel=s.inputParamsVal("-"),n.beforeNature=s.inputParamsVal("-"),n.afterNature=s.inputParamsVal("-"),n.beforeType=s.inputParamsVal("-"),n.afterType=s.inputParamsVal("-"),n.beforeLicenseLey=s.inputParamsVal(a.beforeLicenseLey||"-"),n.afterLicenseLey=s.inputParamsVal(a.afterLicenseLey||"-"),n.beforeBank=s.inputParamsVal(a.beforeBank||"-"),n.afterBank=s.inputParamsVal(a.afterBank),n.beforeBanKCode=s.inputParamsVal(a.beforeBanKCode||"-"),n.afterBankCode=s.inputParamsVal(a.afterBankCode),n.contacts=s.inputParamsVal(a.contacts),n.contactsPhone=s.inputParamsVal(a.contactsPhone),n.techZy=s.inputParamsVal(0),n.techHigh=s.inputParamsVal(0),n.techmiddle=s.inputParamsVal(0),n.techLow=s.inputParamsVal(0),n.yingyeNum=s.inputParamsVal(0),n.note=s.inputParamsVal(a.note),n.unionid=s.inputParamsVal(a.unionid),n.manageType=s.inputParamsVal(a.manageType),n.changeUnit=s.inputParamsVal(a.changeUnit),n.Region=s.inputParamsVal(a.Region),n.batch=s.inputParamsVal(a.quarter),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(1*a.lat),n.lng=s.inputParamsVal(1*a.lng),n.creditcode=s.inputParamsVal(a.creditCode),n.business=s.inputParamsVal("-"),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.businessPractice=s.inputParamsVal("-"),n.level=s.inputParamsVal(a.level),n.memberTel=s.inputParamsVal(a.memberTel),n.pharmacist=s.inputParamsVal(a.pharmacist||a.physician),n.pharmacistIdcard=s.inputParamsVal(a.YSIdcard),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.Insurance=s.inputParamsVal(a.Insurance),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.softName=s.inputParamsVal(a.SoftwareISPName),n.softBegin=s.inputParamsVal(a.SoftwareISPBeginTime),n.softEnd=s.inputParamsVal(a.SoftwareISPEndTime),n.netName=s.inputParamsVal(a.NetWorkISPName),n.netBegin=s.inputParamsVal(a.NetWorkISPBeginTime),n.netEnd=s.inputParamsVal(a.NetWorkISPEndTime),n.type=s.inputParamsVal(a.type),n.ownShip=s.inputParamsVal(a.ownership),n.businessNature=s.inputParamsVal(a.businessNature),n.officeNum=s.inputParamsVal(a.officeNumber),n.bedNum=s.inputParamsVal(a.bedNumber),n.area=s.inputParamsVal(a.floorSpace),n.licenseKey=s.inputParamsVal(a.licensKey),n.onlyCode=s.inputParamsVal(a.onlyCode),n.onemoNum=s.inputParamsVal(a.oenmoNumber),n.dockerHigh=s.inputParamsVal(a.dockerHigh),n.dockermiddle=s.inputParamsVal(a.dockermiddle),n.dockerLow=s.inputParamsVal(a.dockerLow),n.nurseHigh=s.inputParamsVal(a.nurseHigh),n.nursemiddle=s.inputParamsVal(a.nursemiddle),n.nurseLow=s.inputParamsVal(a.nurseLow),n.MedicalTechniciansHigh=s.inputParamsVal(a.MedicalTechniciansHigh),n.MedicalTechniciansmiddle=s.inputParamsVal(a.MedicalTechniciansmiddle),n.MedicalTechniciansLow=s.inputParamsVal(a.MedicalTechniciansLow),n.organCountryCode=s.inputParamsVal(a.organCountryCode||"-"),s.executeProcedure("M_INFO_CHANGE",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/updateDrugChange",((e,t)=>{const a=e.body,n={};n.id=s.inputParamsVal(a.bindId),n.bindId=s.inputParamsVal(a.bindId),n.beforeName=s.inputParamsVal(a.beforeName||"-"),n.afterName=s.inputParamsVal(a.afterName),n.beforeMember=s.inputParamsVal(a.beforeMember||"-"),n.afterMember=s.inputParamsVal(a.afterMember),n.beforeAddress=s.inputParamsVal(a.beforeAddress||"-"),n.afterAddress=s.inputParamsVal(a.afterAddress),n.beforeArea=s.inputParamsVal(a.beforeArea||"-"),n.afterArea=s.inputParamsVal(a.afterArea),n.beforeBank=s.inputParamsVal(a.beforeBank||"-"),n.afterBank=s.inputParamsVal(a.afterBank),n.beforeBanKCode=s.inputParamsVal(a.beforeBanKCode||"-"),n.afterBankCode=s.inputParamsVal(a.afterBankCode),n.contacts=s.inputParamsVal(a.contacts),n.contactsPhone=s.inputParamsVal(a.contactsPhone),n.techZy=s.inputParamsVal("-"),n.techHigh=s.inputParamsVal(a.techHigh),n.techmiddle=s.inputParamsVal(a.techmiddle),n.techLow=s.inputParamsVal(a.techLow),n.yingyeNum=s.inputParamsVal(a.yingyeNum),n.note=s.inputParamsVal(a.note),n.unionid=s.inputParamsVal(a.unionid),n.manageType=s.inputParamsVal(a.manageType),n.changeUnit=s.inputParamsVal(a.changeUnit),n.Region=s.inputParamsVal(a.Region),n.batch=s.inputParamsVal(a.quarter),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(1*a.lat),n.lng=s.inputParamsVal(1*a.lng),n.creditcode=s.inputParamsVal(a.creditCode),n.business=s.inputParamsVal(a.business),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.businessPractice=s.inputParamsVal(a.businessPractice),n.level=s.inputParamsVal(a.level),n.memberTel=s.inputParamsVal(a.memberTel),n.pharmacist=s.inputParamsVal(a.pharmacist),n.pharmacistIdcard=s.inputParamsVal(a.YSIdcard),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.Insurance=s.inputParamsVal(a.Insurance),n.beginBusinessTime=s.inputParamsVal(a.beginTime),n.endBusinessTime=s.inputParamsVal(a.endTime),n.softName=s.inputParamsVal(a.SoftwareISPName),n.softBegin=s.inputParamsVal(a.SoftwareISPBeginTime),n.softEnd=s.inputParamsVal(a.SoftwareISPEndTime),n.netName=s.inputParamsVal(a.NetWorkISPName),n.netBegin=s.inputParamsVal(a.NetWorkISPBeginTime),n.netEnd=s.inputParamsVal(a.NetWorkISPEndTime),n.type=s.inputParamsVal("-"),n.ownShip=s.inputParamsVal("-"),n.businessNature=s.inputParamsVal("-"),n.officeNum=s.inputParamsVal("-"),n.bedNum=s.inputParamsVal(0),n.area=s.inputParamsVal(0),n.licenseKey=s.inputParamsVal("-"),n.onlyCode=s.inputParamsVal("-"),n.onemoNum=s.inputParamsVal(0),n.dockerHigh=s.inputParamsVal(0),n.dockermiddle=s.inputParamsVal(0),n.dockerLow=s.inputParamsVal(0),n.nurseHigh=s.inputParamsVal(0),n.nursemiddle=s.inputParamsVal(0),n.nurseLow=s.inputParamsVal(0),n.MedicalTechniciansHigh=s.inputParamsVal(0),n.MedicalTechniciansmiddle=s.inputParamsVal(0),n.MedicalTechniciansLow=s.inputParamsVal(0),n.organCountryCode=s.inputParamsVal(a.organCountryCode||"-"),s.executeProcedure("M_UPDATE_INFO_CHANGE",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/updateMedicalChange",((e,t)=>{const a=e.body,n={};n.id=s.inputParamsVal(a.bindId),n.bindId=s.inputParamsVal(a.bindId),n.beforeName=s.inputParamsVal(a.beforeName||"-"),n.afterName=s.inputParamsVal(a.afterName),n.beforeMember=s.inputParamsVal(a.beforeMember||"-"),n.afterMember=s.inputParamsVal(a.afterMember),n.beforeAddress=s.inputParamsVal(a.beforeAddress||"-"),n.afterAddress=s.inputParamsVal(a.afterAddress),n.beforeArea=s.inputParamsVal("-"),n.afterArea=s.inputParamsVal("-"),n.beforeBank=s.inputParamsVal(a.beforeBank||"-"),n.afterBank=s.inputParamsVal(a.afterBank),n.beforeBanKCode=s.inputParamsVal(a.beforeBanKCode||"-"),n.afterBankCode=s.inputParamsVal(a.afterBankCode),n.contacts=s.inputParamsVal(a.contacts),n.contactsPhone=s.inputParamsVal(a.contactsPhone),n.techZy=s.inputParamsVal(0),n.techHigh=s.inputParamsVal(0),n.techmiddle=s.inputParamsVal(0),n.techLow=s.inputParamsVal(0),n.yingyeNum=s.inputParamsVal(0),n.note=s.inputParamsVal(a.note),n.unionid=s.inputParamsVal(a.unionid),n.manageType=s.inputParamsVal(a.manageType),n.changeUnit=s.inputParamsVal(a.changeUnit),n.Region=s.inputParamsVal(a.Region),n.batch=s.inputParamsVal(a.quarter),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(1*a.lat),n.lng=s.inputParamsVal(1*a.lng),n.creditcode=s.inputParamsVal(a.creditCode),n.business=s.inputParamsVal("-"),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.businessPractice=s.inputParamsVal("-"),n.level=s.inputParamsVal(a.level),n.memberTel=s.inputParamsVal(a.memberTel),n.pharmacist=s.inputParamsVal(a.pharmacist||a.physician),n.pharmacistIdcard=s.inputParamsVal(a.YSIdcard),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.Insurance=s.inputParamsVal(a.Insurance),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.softName=s.inputParamsVal(a.SoftwareISPName),n.softBegin=s.inputParamsVal(a.SoftwareISPBeginTime),n.softEnd=s.inputParamsVal(a.SoftwareISPEndTime),n.netName=s.inputParamsVal(a.NetWorkISPName),n.netBegin=s.inputParamsVal(a.NetWorkISPBeginTime),n.netEnd=s.inputParamsVal(a.NetWorkISPEndTime),n.type=s.inputParamsVal(a.type),n.ownShip=s.inputParamsVal(a.ownership),n.businessNature=s.inputParamsVal(a.businessNature),n.officeNum=s.inputParamsVal(a.officeNumber),n.bedNum=s.inputParamsVal(a.bedNumber),n.area=s.inputParamsVal(a.floorSpace),n.licenseKey=s.inputParamsVal(a.licensKey),n.onlyCode=s.inputParamsVal(a.onlyCode),n.onemoNum=s.inputParamsVal(a.oenmoNumber),n.dockerHigh=s.inputParamsVal(a.dockerHigh),n.dockermiddle=s.inputParamsVal(a.dockermiddle),n.dockerLow=s.inputParamsVal(a.dockerLow),n.nurseHigh=s.inputParamsVal(a.nurseHigh),n.nursemiddle=s.inputParamsVal(a.nursemiddle),n.nurseLow=s.inputParamsVal(a.nurseLow),n.MedicalTechniciansHigh=s.inputParamsVal(a.MedicalTechniciansHigh),n.MedicalTechniciansmiddle=s.inputParamsVal(a.MedicalTechniciansmiddle),n.MedicalTechniciansLow=s.inputParamsVal(a.MedicalTechniciansLow),n.organCountryCode=s.inputParamsVal(a.organCountryCode||"-"),s.executeProcedure("M_UPDATE_INFO_CHANGE",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/get-info",((e,t)=>{const a=["id","bindId","beforename","aftername","beforemember","aftermember","beforeaddress","afteraddress","beforearea","afterarea","beforebank","afterbank","beforebankcode","afterbankcode","contacts","contactsphone","techzy","techhigh","techmiddle","techlow","yingyenum","note","changeunit","Region","beginTime","endTime","locationaddress","creditCode","business","timeLimit","setDate","businesspractice","druglevel","membertel","pharmacist","pharmacistidcard","yibaocharge","yibaochargeTel","insurance","softwareispname","softwareispbegintime","softwareispendtime","networkispname","networkispbegintime","networkispendtime","medicaltype","ownship","businessnature","officenumber","bednumber","dockermiddle","licenskey","dockerhigh","dockerlow","nursehigh","nursemiddle","nurselow","medicaltechnicianshigh","medicaltechniciansmiddle","medicaltechnicianslow","licensonlycode","onemonum","medicalarea","lat","lng","yibaochargeTel","pharmacistidcard","organCountryCode","status"],n={};n.creditCode=s.inputParamsVal(String(e.body.creditCode)),n.quarter=s.inputParamsVal(e.body.quarter),s.executeProcedure("M_GET_CHANGE_INFO",n,s.outputParamsCursor(1)).then((e=>{const n=[];e[0].map((e=>{const t={};e.map(((n,s)=>{t[a[s]]=e[s]})),n.push(t)})),t.json({respData:{status:"0"},respResultsets:[n],respCode:"200"})}))})),e.exports=n},5374:(e,t,a)=>{const n=a(2127).Router(null),s=a(6306),{v1:r}=a(1231),i=a(4271),o=(a(9659),(e,t)=>{t.json({error:e})});n.post("/form",((e,t)=>{const a=e.body,n={},r="base"===a.organType?a.creditCode:`${a.creditCode}-T`;n.name=s.inputParamsVal(a.name),n.address=s.inputParamsVal(a.address),n.Region=s.inputParamsVal(a.Region),n.level=s.inputParamsVal(a.level),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(a.lat),n.lng=s.inputParamsVal(a.lng),n.creditCode=s.inputParamsVal(r),n.onlyCode=s.inputParamsVal(a.onlyCode),n.type=s.inputParamsVal(a.type),n.licensKey=s.inputParamsVal(a.licensKey),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.floorSpace=s.inputParamsVal(a.floorSpace),n.ownership=s.inputParamsVal(a.ownership),n.businessNature=s.inputParamsVal(a.businessNature),n.officeNumber=s.inputParamsVal(a.officeNumber),n.bedNumber=s.inputParamsVal(a.bedNumber),n.oenmoNumber=s.inputParamsVal(a.oenmoNumber),n.member=s.inputParamsVal(a.member),n.memberTel=s.inputParamsVal(a.memberTel),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.physician=s.inputParamsVal(a.physician),n.YSIdcard=s.inputParamsVal(a.YSIdcard||"-"),n.Insurance=s.inputParamsVal(a.Insurance),n.dockerHigh=s.inputParamsVal(a.dockerHigh),n.dockermiddle=s.inputParamsVal(a.dockermiddle),n.dockerLow=s.inputParamsVal(a.dockerLow),n.nurseHigh=s.inputParamsVal(a.nurseHigh),n.nursemiddle=s.inputParamsVal(a.nursemiddle),n.nurseLow=s.inputParamsVal(a.nurseLow),n.MedicalTechniciansHigh=s.inputParamsVal(a.MedicalTechniciansHigh),n.MedicalTechniciansmiddle=s.inputParamsVal(a.MedicalTechniciansmiddle),n.MedicalTechniciansLow=s.inputParamsVal(a.MedicalTechniciansLow),n.unionid=s.inputParamsVal(a.unionid),n.quarter=s.inputParamsVal(a.quarter),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.organType=s.inputParamsVal(a.organType),n.organCode=s.inputParamsVal(a.organCode||"-"),n.organCountryCode=s.inputParamsVal(a.organCountryCode||"-"),s.executeProcedure("ADDMEDICALFORM",n,s.outputParamsCursor(1)).then((e=>{const n={creditCode:r,organName:a.name,pharmacistName:a.physician,pharmacistIDCard:a.YSIdcard||"-",status:"0"};i.findOneAndUpdateOrInsert("pharmacistInfo",{creditCode:r,pharmacistName:a.physician},n),t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{o(e,t)}))})),n.post("/updateForm",((e,t)=>{const a=e.body,n=(new Date,{});n.name=s.inputParamsVal(a.name),n.address=s.inputParamsVal(a.address),n.Region=s.inputParamsVal(a.Region),n.level=s.inputParamsVal(a.level),n.locationAddress=s.inputParamsVal(a.locationAddress),n.lat=s.inputParamsVal(a.lat),n.lng=s.inputParamsVal(a.lng),n.creditCode=s.inputParamsVal(a.creditCode),n.onlyCode=s.inputParamsVal(a.onlyCode),n.type=s.inputParamsVal(a.type),n.licensKey=s.inputParamsVal(a.licensKey),n.timeLimit=s.inputParamsVal(a.timeLimit.toString()),n.setDate=s.inputParamsVal(a.setDate),n.floorSpace=s.inputParamsVal(a.floorSpace),n.ownership=s.inputParamsVal(a.ownership),n.businessNature=s.inputParamsVal(a.businessNature),n.officeNumber=s.inputParamsVal(a.officeNumber),n.bedNumber=s.inputParamsVal(a.bedNumber),n.oenmoNumber=s.inputParamsVal(a.oenmoNumber),n.member=s.inputParamsVal(a.member),n.memberTel=s.inputParamsVal(a.memberTel),n.yibaoCharge=s.inputParamsVal(a.yibaoCharge),n.yibaoChargeTel=s.inputParamsVal(a.yibaoChargeTel),n.physician=s.inputParamsVal(a.physician),n.YSIdcard=s.inputParamsVal(a.YSIdcard||"-"),n.Insurance=s.inputParamsVal(a.Insurance),n.dockerHigh=s.inputParamsVal(a.dockerHigh),n.dockermiddle=s.inputParamsVal(a.dockermiddle),n.dockerLow=s.inputParamsVal(a.dockerLow),n.nurseHigh=s.inputParamsVal(a.nurseHigh),n.nursemiddle=s.inputParamsVal(a.nursemiddle),n.nurseLow=s.inputParamsVal(a.nurseLow),n.MedicalTechniciansHigh=s.inputParamsVal(a.MedicalTechniciansHigh),n.MedicalTechniciansmiddle=s.inputParamsVal(a.MedicalTechniciansmiddle),n.MedicalTechniciansLow=s.inputParamsVal(a.MedicalTechniciansLow),n.unionid=s.inputParamsVal(a.unionid),n.quarter=s.inputParamsVal(a.quarter),n.beginBusinessTime=s.inputParamsVal(a.beginBusinessTime),n.endBusinessTime=s.inputParamsVal(a.endBusinessTime),n.organCode=s.inputParamsVal(a.organCode||"-"),n.organCountryCode=s.inputParamsVal(a.organCountryCode||"-"),s.executeProcedure("M_UPDATE_MEDICAL_FORM",n,s.outputParamsCursor(1)).then((e=>{t.json({respData:{status:"0"},respResultsets:e[0],respCode:"200"})})).catch((e=>{o(e,t)}))})),n.post("/getUuid",((e,t)=>{const a="ccsyb-"+e.body.type+"-medical-"+r();t.json({respData:{status:"0"},respResultsets:[a],respCode:"200"})})),n.post("/get-info",(async(e,t)=>{const a=await i.select("qrCodeCcsyb",{code:e.body.code});if(a.length>0)if("1"==a[0].status){const e={},n=await i.select("userInfo",{unionid:a[0].unionid,selfSign:"1"}).then();e.cardNo=s.inputParamsVal(n[0].shenFenZh);const r={};r.name=n[0].xingMing,r.phone=a[0].tel,r.IDCard=n[0].shenFenZh,r.status="1",r.msg="success",t.json(r)}else t.json("111");else t.json("111")})),e.exports=n},1418:(e,t,a)=>{const n=a(2127).Router(null),s=a(8633),r=a(1671),i=a(5747),o=a(6306),l=a(4271);let u=s({dest:a(3876).imgs});n.post("/uploadimg",u.single("file"),(function(e,t,a){const n=e.body;if(0!==e.file.length){let a=e.file;const s=a.originalname.split(".")[0]+"."+a.originalname.split(".")[a.originalname.split(".").length-1];i.renameSync(a.destination+a.filename,a.destination+n.unionid+s);let l=i.readFileSync(a.destination+n.unionid+s);const u=new Buffer(l).toString("base64");let c="data:"+r.lookup(a.destination+n.unionid+s)+";base64,"+u;i.writeFileSync(a.destination+n.unionid+a.originalname.split(".")[0]+".txt",c,(e=>{console.log(e)})),i.unlinkSync(a.destination+n.unionid+s);const d={unionid:n.unionid,no:n.unionid+n.timestamp,name:n.name,mimetype:a.mimetype,file:n.unionid+n.name,note:"",status:"1"},m="SET_QUALIFICATIONS_FILE",p={};p.code=o.inputParamsVal(n.code+n.timestamp+n.name+n.no),p.name=o.inputParamsVal(n.name),p.file=o.inputParamsVal(c),p.status=o.inputParamsVal("0"),p.fileType=o.inputParamsVal(a.mimetype),p.timestamp=o.inputParamsVal(n.timestamp),p.fileCreditcode=o.inputParamsVal(n.code),p.quarter=o.inputParamsVal(n.quarter),o.executeProcedure(m,p,o.outputParamsCursor(1)).then((e=>{"1"===e[0][0][0]&&t.json({respData:{status:1},respResultsets:[d],respCode:"200"})})).catch((e=>{((e,t)=>{t.json({error:e})})(e,t)}))}else t.render("error",{message:"上传文件不能为空！"})})),n.post("/submit",((e,t)=>{const a=e.body,n={region:"-"};n.memberName=a.memberName,n.idcard=a.idcard,n.id=a.id,n.name=a.name,n.member=a.member,n.phone=a.phone,n.timestamp=a.timestamp,n.isChain=a.isChain,n.chainUnionCode=a.chainUnionCode,n.fileNos=a.fileNos,n.quarter=o.inputParamsVal(a.quarter),o.executeProcedure("SET_QUALIFICATIONS_INFO",n,o.outputParamsCursor(1)).then((async e=>{await l.findOneAndUpdateOrInsert("chainCodeInfo",{chainName:a.name},{chainName:a.name,creditCode:a.chainUnionCode}),t.json({respData:{status:1},respResultsets:[{status:e[0][0][0],msg:e[0][0][1]}],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/getChainCode",(async(e,t)=>{const a=e.body,n=await l.select("chainCodeInfo",{chainName:a.name});t.json({respData:{status:1},respResultsets:[n[0]],respCode:"200"})})),n.post("/getInfo",((e,t)=>{const a=e.body,n={};n.unionid=o.inputParamsVal(a.id),n.quarter=o.inputParamsVal(a.quarter);const s=["uuid","unionid","idCard","memberName","name","member","phone","timestamp","isChain","chainCode","status","errFiles","note"],r={};o.executeProcedure("GET_QUALIFICATIONS_INFO",n,o.outputParamsCursor(1)).then((e=>{e[0].length>0&&s.map(((t,a)=>{r[s[a]]=e[0][0][a]})),t.json({respData:{status:1},respResultsets:[r],respCode:"200"})})).catch((e=>{t.json(e)}))})),n.post("/change",(async(e,t)=>{const a=e.body,n={};n.beforeName=o.inputParamsVal(a.beforeName),n.beforeUnionid=o.inputParamsVal(a.beforeUnionid),n.afterName=o.inputParamsVal(a.afterName),n.afterUnionid=o.inputParamsVal(a.afterUnionid),o.executeProcedure("M_GET_CHANGE_USER",n,o.outputParamsCursor(1)).then((e=>{console.log(e),t.json({respData:{status:1},respResultsets:[e[0][0]],respCode:"200"})}))})),e.exports=n},4097:(e,t,a)=>{const n=a(2127).Router(null),s=a(4271),r=a(6306),{v1:i}=a(1231);n.post("/get-login-status",(async(e,t)=>{const a=await s.select("qrCodeCcsyb",{code:e.body.code});if(a.length>0)if("1"==a[0].status){const n=await s.select("userInfo",{unionid:a[0].unionid,selfSign:"1"}).then(),i="REGISTER_USER",o={};o.unionid=r.inputParamsVal(n[0].unionid),o.name=r.inputParamsVal(n[0].xingMing),o.phone=r.inputParamsVal(a[0].tel),r.executeProcedure(i,o,r.outputParamsCursor(2)).then((async s=>{if("1"==s[1][0][0]){new RegExp(`^.*"unionid":"${n[0].unionid}","loginStatus":"ldjg".*$`);const r={};r.uuid=s[0][0][0],r.state=a[0].status,r.status=s[0][0][9],r.name=n[0].xingMing,r.phone=a[0].tel,r.IDCard=n[0].shenFenZh,r.organName=s[0][0][1],r.authority=s[0][0][4],r.scope=s[0][0][5],r.isChain=s[0][0][6],r.chainCode=s[0][0][7],e.session.unionid=n[0].unionid,e.session.loginStatus="ldjg",t.json(r)}})).catch((e=>{t.json(e)}))}else t.json("111");else t.json("111")})),n.post("/setSession",((e,t)=>{console.log(e.body),e.session.unionid=e.body.unionid,e.session.loginStatus="ldjg",t.json({respData:{status:"0"},respResultsets:[["1"]],respCode:"200"})})),n.post("/logout",(async(e,t)=>{e.session.destroy(),t.json({status:"1"})})),n.post("/clearSrssion",(async(e,t)=>{const a=new RegExp(`^.*"unionid":"${e.body.unionid}","loginStatus":"ldjg".*$`),n=s.remove("ldjgSession",{session:a});t.json(n)})),n.post("/check-login-status",(async(e,t)=>{await s.select("userInfo",{unionid:"oEv7q1EINNWE-0QIZ_Mlo9dheHM8"})})),n.post("/getUuid",((e,t)=>{const a="ccsyb-"+e.body.type+"-"+i();t.json({respData:{status:"0"},respResultsets:[a],respCode:"200"})})),n.get("/test",((e,t)=>{t.json("SUCCESS!!!!")})),e.exports=n},2231:(e,t,a)=>{const n=a(2127).Router(null),s=a(5747),r=a(6172),i=a(3690),o=a(4271),l=a(6306),u=a(3863),c=a(6709),d=a(2791),m=a(9795);function p(e){return e*Math.PI/180}function g(e,t,a,n,s,r){var i=p(e),o=p(a),l=i-o,u=p(t)-p(n),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(l/2),2)+Math.cos(i)*Math.cos(o)*Math.pow(Math.sin(u/2),2)));c*=6378.137;var d,m=c=Math.round(1e4*c)/1e4;return d=1*m>=1?m.toFixed(1)+"km":1e3*m+"m",console.info("lyj 距离是",c),console.info("lyj 距离是",d),c}a(6297),n.post("/test",((e,t)=>{const a=e.body;r(a.unionId,a.type,a.name,a.status),t.json("11")})),n.get("/receiveNotice",((e,t)=>{console.log(e.query);const a=e.query,{message:n,id:s}=m.decrypt("X7xebjbCRUWb8kymShFYQYVItnwfWOeBRUkW1UVBagk",a.echostr);console.log(n),t.send(n)})),n.post("/createFapiao",((e,t)=>{const a=new u;a.pipe(s.createWriteStream(`${process.cwd()}/fapiao.pdf`)),a.font(`${process.cwd()}/msyh.ttf`),a.image(`${process.cwd()}/fapiao.png`,20,100,{width:570,height:342,align:"center"}),a.image(`${process.cwd()}/zhang.png`,440,280,{width:60,height:60,align:"right"}),a.end(),t.json("1111")})),n.post("/getMysql",(async(e,t)=>{const a=await i.executeProcedure("proc_get_organ_info",["91220106MA171D8FXW"]);t.json(a)})),n.post("/get-down-list",(async(e,t)=>{const a=(await o.select("userInfo",{unionid:"oEv7q1AKAkw6WDYLVLh1sIuQzWl8"}))[0].openid;r(a)})),n.get("/testUrl",(async(e,t)=>{t.json("SUCCESS")}));const P=[{title:"吉林省禹成药房连锁有限公司西环路店",lat:44.4243014167984,lng:125.13904665745402},{title:"吉林省正开医药连锁有限公司长春中铁城店",lat:43.860862317783095,lng:125.152436779177},{title:"长春汽车经济技术开发区百皓口腔门诊部",lat:43.828575466135604,lng:125.16335982268201},{title:"长春市弘信大药房有限责任公司",lat:43.82902217733219,lng:125.16421687226101},{title:"吉林省泓济大药房有限公司",lat:43.865788763205295,lng:125.18788938776301},{title:"长春市国邦大药房万龙店",lat:43.861877756727196,lng:125.187969695042},{title:"长春市绿园区松林大药房",lat:43.860390066216794,lng:125.19641286395502},{title:"吉林大药房药业股份有限公司支农大街连锁店",lat:43.857870190876596,lng:125.20141202634501},{title:"长春汽车经济技术开发区鼎元堂大药房",lat:43.840210684884596,lng:125.203013330335},{title:"长春汽车经济技术开发区弘盛堂综合门诊",lat:43.84010211101249,lng:125.20306030075},{title:"吉林省明澳宝善堂药房连锁有限公司支农店",lat:43.85812380265268,lng:125.203396179253},{title:"汽车经济技术开发区君地综合门诊部",lat:43.8387800655699,lng:125.20419538161},{title:"长春君瑞百信大药房有限公司",lat:43.8387138955194,lng:125.204249317978},{title:"长春市京康大药房有限有限公司",lat:43.8243885116044,lng:125.20999953825101},{title:"长春市福民堂大药房有限公司",lat:43.8407848450863,lng:125.21300907576001},{title:"吉林省九乐堂药房有限责任公司长春市顺通小区连锁店",lat:43.8252041713494,lng:125.214983174454},{title:"长春汽车经济技术开发区怡安综合门诊部",lat:43.8366791693853,lng:125.21521589652102},{title:"汽车经济技术开发区同盛综合门诊部",lat:43.860410497957695,lng:125.22145815691},{title:"吉林省康瑞大药房有限公司",lat:43.877109962221496,lng:125.222347663473},{title:"长春义善堂大药房连锁有限公司安庆连锁店",lat:43.86433483329114,lng:125.22263741994499},{title:"长春市同馨大药房有限公司",lat:43.8867331545698,lng:125.226044707638},{title:"绿园优一口腔门诊部",lat:43.8867319422291,lng:125.227975373033},{title:"长春市和美忠锋大药房有限公司",lat:43.886124465599195,lng:125.227982713646},{title:"吉林省禹成药房连锁有限公司长春民悦街店",lat:43.89275689266753,lng:125.228727090745},{title:"吉林大药房药业股份有限公司博众新城连锁店",lat:43.865123673269395,lng:125.22896525417401},{title:"绿园区易康和综合门诊部",lat:43.8873875295568,lng:125.229110373697},{title:"吉林省养天和康赛大药房连锁有限公司长春兴杰店",lat:43.83914993503882,lng:125.22954394888299},{title:"长春市修正中海景阳大药房有限公司",lat:43.8855981151133,lng:125.22956873317901},{title:"长春市御心堂大药房",lat:43.8858880312004,lng:125.22965082280301},{title:"汽车经济技术开发区启点口腔门诊部",lat:43.8378578718665,lng:125.229958948844},{title:"吉林省福益堂大药房有限责任公司",lat:43.842809458264696,lng:125.231310402778},{title:"长春市正德堂大药房",lat:43.887357712628,lng:125.231325521415},{title:"长春义善堂大药房连锁有限公司博众连锁店",lat:43.80478276690248,lng:125.233115149704},{title:"长春义善堂大药房连锁有限公司飞跃路连锁店",lat:43.856946582299244,lng:125.23544609467301},{title:"汽车经济技术开发区雅正口腔门诊部",lat:43.8465444071329,lng:125.23678063061399},{title:"长春义善堂大药房连锁有限公司东风连锁店",lat:43.85589006921933,lng:125.236842418367},{title:"长春市康派琪大药房有限公司",lat:43.859160624244595,lng:125.238565655414},{title:"吉林省正开医药连锁有限公司长春豪邦缇香公馆店",lat:43.8492920224323,lng:125.23929144668001},{title:"长春市绿园区四季大药房",lat:43.896139808532396,lng:125.24262494729501},{title:"长春市志成大药房连锁有限公司自兴路店",lat:43.87030587054438,lng:125.24318588199601},{title:"吉林大药房药业股份有限公司长春西城家园连锁店",lat:43.88304387670144,lng:125.24360181182199},{title:"长春市枫林大药房",lat:43.871424991507496,lng:125.24567812563402},{title:"吉林省一汽总医院",lat:43.8624182892285,lng:125.249436700846},{title:"长春海王星辰医药有限公司天茂城分店",lat:43.8666681626597,lng:125.25190114279401},{title:"吉林省金牛大药房有限责任公司长春市多恩店",lat:43.86688228398107,lng:125.252000406148},{title:"长春汽车经济技术开发区鑫康捷大药房有限公司",lat:43.87281958907601,lng:125.252365661419},{title:"汽车经济技术开发区名仕综合门诊",lat:43.8733323641969,lng:125.25238304141101},{title:"长春九鑫医药有限公司碧水云天分公司",lat:43.88085369348649,lng:125.25330433886401},{title:"汽车经济技术开发区天茂宝康源大药房",lat:43.868687173164,lng:125.25458158302101},{title:"绿园区爱民综合门诊部",lat:43.904274586561,lng:125.25540138618001},{title:"吉林御本堂华升大药房有限公司",lat:43.8673864911575,lng:125.256093433278},{title:"长春市百康堂大药房有限公司",lat:43.89945237244225,lng:125.256574354959},{title:"汽开优沪口腔门诊部",lat:43.867975145357995,lng:125.256589436475},{title:"吉林省世德堂四季青药房有限公司",lat:43.9162248158569,lng:125.25752207897601},{title:"绿园区佳德口腔门诊部",lat:43.899773798668,lng:125.25780465111801},{title:"吉林省明澳宝善堂药房连锁有限公司天城店",lat:43.82460253245386,lng:125.258847465813},{title:"长春市家和大药房有限公司",lat:43.88652144464511,lng:125.262502382186},{title:"吉林省禹成药房连锁有限公司大营子店",lat:43.990622475745894,lng:125.262505709688},{title:"长春盛国堂大药房有限公司",lat:43.88272152527433,lng:125.262580945519},{title:"长春市康润合大药房有限公司",lat:43.898102452063384,lng:125.263562208067},{title:"长春市恒实同康大药房有限公司",lat:43.9183244129072,lng:125.263869886249},{title:"吉林省禹成药房连锁有限公司大成店",lat:43.938155648377695,lng:125.26585972512001},{title:"长春同康大药房连锁股份有限公司华瀚四季店",lat:43.9027089707422,lng:125.266002358227},{title:"长春市爱心德润大药房",lat:43.8876473733725,lng:125.26652181314601},{title:"长春市康顺堂医药有限公司",lat:43.904654129,lng:125.269456075281},{title:"长春市绿园区和平口腔门诊部",lat:43.9082143790916,lng:125.270158716481},{title:"长春义善堂大药房连锁有限公司车百连锁店",lat:43.87136097357189,lng:125.27078812805901},{title:"长春市福铭康药品零售有限公司",lat:43.896489541953315,lng:125.27171981479901},{title:"绿园区英华口腔门诊部",lat:43.889789795286504,lng:125.272001607898},{title:"长春市万福和康大药房有限公司",lat:43.8857104422889,lng:125.272984393216},{title:"长春市绿园区德聚堂大药房",lat:43.9047927967519,lng:125.27459662254401},{title:"长春市绿园区圣泰同任大药房有限公司",lat:43.90829211097858,lng:125.27467696888701},{title:" 长春市康益堂药房有限公司",lat:43.9783754969971,lng:125.27601666913701},{title:"长春市绿园区盛泰同任大药房有限公司",lat:43.90795578147023,lng:125.27644619965001},{title:"绿园区君齿健口腔门诊部",lat:43.9023489436202,lng:125.27647761492202},{title:"绿园区启源大药房",lat:43.8943892869477,lng:125.277444007612},{title:"长春中吉皮肤病医院",lat:43.8995740224727,lng:125.277526198028},{title:"吉林省禹成药房连锁有限公司四间新村店",lat:43.973094778892396,lng:125.281271729961},{title:"长春同康大药房连锁股份有限公司普济堂店",lat:43.8914072842251,lng:125.282356682084},{title:"绿园区瀚康综合门诊部",lat:43.88691562908709,lng:125.283148045575},{title:"绿园区润身中医门诊部",lat:43.8869459093562,lng:125.28318934403801},{title:"长春市绿园区惠康万嘉大药房有限公司",lat:43.92844057787639,lng:125.28331058940701},{title:"长春同康大药房连锁股份有限公司万嘉店",lat:43.92851070101509,lng:125.28400934687501},{title:"长春市鑫艳药房",lat:43.9146769936743,lng:125.284368141783},{title:"绿园区同泰口腔门诊部",lat:43.8814008434812,lng:125.28562037505},{title:"长春市义和堂大药房有限公司",lat:43.887879630546195,lng:125.285671397284},{title:"长春市万嘉吉鑫大药房有限公司",lat:43.9277040970182,lng:125.28631944601301},{title:"长春市通康大药房",lat:43.8802893429575,lng:125.28837654158501},{title:"国大益和大药房吉林有限公司长春泰来街连锁店",lat:43.880140616564496,lng:125.289099269446},{title:"吉林省养天和康赛大药房连锁有限公司长春基隆店",lat:43.947907719091724,lng:125.289550277358},{title:"长春同康大药房连锁股份有限公司普阳街店",lat:43.8893457729459,lng:125.289814014856},{title:"长春市沁心大药房有限公司",lat:43.9095834356674,lng:125.290337014916},{title:"长春市纯正堂大药房",lat:43.9042236102817,lng:125.292486735395},{title:"长春市愈康大药房有限公司普阳店",lat:43.90188716923031,lng:125.296451079106},{title:"国大益和大药房吉林有限公司长春皓月大路连锁店",lat:43.8924108285932,lng:125.296788972728},{title:"绿园区刘羽霞口腔门诊部",lat:43.920290953110204,lng:125.297665131356},{title:"绿园区林氏普仁综合门诊部",lat:43.917453702892296,lng:125.297711330075},{title:"绿园王福成口腔门诊部",lat:43.9042531422809,lng:125.29812631911301},{title:"吉林省尚宏裕大药房连锁有限公司翔运街分公司",lat:43.893858243544095,lng:125.298473587643},{title:"吉林省九乐堂药房有限责任公司长春市春阳街连锁店",lat:43.90700487966888,lng:125.300975911419},{title:"国大益和大药房吉林有限公司长春娜奇美连锁店",lat:43.864090052524126,lng:125.30129489630501},{title:"长春市愈安堂大药房",lat:43.8986887198726,lng:125.30268265551001},{title:"绿园区三棵松大药房",lat:43.9257221836449,lng:125.30388510336601},{title:"吉林省养天和康赛大药房连锁有限公司长春青萍路店",lat:43.92675611649628,lng:125.31000580450801},{title:"绿园区民昇综合门诊部",lat:43.9251510847676,lng:125.31372832642201},{title:"长春市花语药房有限责任公司",lat:43.933637280548794,lng:125.313845542485},{title:"汽开利民口腔门诊部",lat:43.8217796901203,lng:125.33016977757},{title:"长春市盛济堂大药房有限公司",lat:43.88304387670144,lng:125.24360181182199}];n.post("/countDsitance",(async(e,t)=>{const a=P.sort(((e,t)=>e.lat-t.lat));P.map(((e,t)=>e.no=t));for(let e=0;e<a.length;e++){const t=a.slice(e+1);for(let n=0;n<t.length;n++)await g(a[e].lat,a[e].lng,t[n].lat,t[n].lng,a[e].title,t[n].title)}console.log(a),console.log(a[0],a[a.length-1])})),n.post("/getPosition",(async(e,t)=>{const a=s.readFileSync(`${process.cwd()}/1.txt`,"utf-8"),n=["title","lat","lng"],r=a.split(","),i=[],o=[];for(let e=0;e<r.length;e++){const t={};t.quarter=l.inputParamsVal(r[e]);const a=await l.executeProcedure("GET_POSITION",t,l.outputParamsCursor(1));if(a[0][0]){const e={};a[0][0].map(((t,a)=>{e[n[a]]=t})),i.push(e)}else o.push(r[e])}t.json({respData:{status:"0"},respResultsets:i.sort(((e,t)=>e.lat-t.lat&&e.lng-t.lng)),respResultsets2:o,respCode:"200"})})),n.post("/insert",(async(e,t)=>{const a=d.children[3].children[1].id,n=(await s.readFileSync(`${process.cwd()}/1.txt`,"utf-8")).split(","),r=["法人","医保负责人"];for(let e=0;e<n.length;e++){const t={parent_id:a,name:n[e],outer_dept:!0,outer_dept_only_self:!0},s=await c.postRequest("https://oapi.dingtalk.com/topapi/v2/department/create?access_token=5f7fed3c03b331409792984d44828571",t);console.log(t);const i=JSON.parse(s.body);console.log(i);const o=i.result.dept_id;for(let e=0;e<r.length;e++){const t={parent_id:o,name:r[e],outer_dept:!0,outer_dept_only_self:!0};await c.postRequest("https://oapi.dingtalk.com/topapi/v2/department/create?access_token=5f7fed3c03b331409792984d44828571",t)}}})),n.post("/insert2",(async(e,t)=>{const a=530679812,n=(await s.readFileSync(`${process.cwd()}/1.txt`,"utf-8")).split(","),r=["法人","医保负责人","门店"];for(let e=0;e<n.length;e++){const t={parent_id:a,name:n[e],outer_dept:!0,outer_dept_only_self:!0},s=await c.postRequest("https://oapi.dingtalk.com/topapi/v2/department/create?access_token=4169159b83d837f5920f9634335f8882",t),i=JSON.parse(s.body);if(console.log(t),console.log(i),i.errcode)continue;const o=obj1.children.find((e=>e.id===t.parent_id)),l=i.result.dept_id;o.children.push({id:l,name:t.name,children:[]});for(let e=0;e<r.length;e++){const t={parent_id:l,name:r[e],outer_dept:!0,outer_dept_only_self:!0},n=await c.postRequest("https://oapi.dingtalk.com/topapi/v2/department/create?access_token=4169159b83d837f5920f9634335f8882",t),s=JSON.parse(n.body),i=obj1.children.find((e=>e.id===a)).children.find((e=>e.id===t.parent_id)),o=s.result.dept_id;i.children.push({id:o,name:t.name})}}const i=await s.writeFileSync(`${process.cwd()}/4.txt`,JSON.stringify(obj1));console.log(i),t.json("111")})),n.post("/insertDrugLS",(async(e,t)=>{const a=d.children[3].children[0],n=(await s.readFileSync(`${process.cwd()}/organs.txt`,"utf-8")).split(",");for(let e=0;e<n.length;e++){const t=n[e].split("-"),s=a.children.find((e=>e.name===t[0])).children.find((e=>"门店"===e.name)),r={parent_id:s.id,name:t[1],outer_dept:!0,outer_dept_only_self:!0},i=await c.postRequest("https://oapi.dingtalk.com/topapi/v2/department/create?access_token=5f7fed3c03b331409792984d44828571",r),o=JSON.parse(i.body);console.log(r),console.log(o);const l=o.result.dept_id;s.children.push({id:l,name:r.name,children:[]})}await s.writeFileSync(`${process.cwd()}/4.txt`,JSON.stringify(d)),t.json("111")})),e.exports=n},2189:(e,t,a)=>{const n=a(5747),s={A:["creditCode","name","address","Region","member","type","level","ownship","nature","officeNum","bedNum","onemoNum","area","ybCharge","ybChargeTel","setDate","licenseKey","insurance","dockerH","dockerM","dockerL","nurseH","nurseM","nurseL","meTechH","meTechM","meTechL","applyDate","locationAddress","memberTel","timeLimit","onlyCode","beginTime","endTime"],B:["creditCode","name","address","Region","member","practice","area","ybCharge","ybChargeTel","business","setDate","level","pharmacist","insurance","techH","techM","techL","yingyeNum","applyDate","locationAddress","lat","lng","memberTel","timeLimit","yingYeTime"],change:["id","beforeName","afterName","beforeMember","afterMember","beforeAddress","afterAddress","beforeArea","afterArea","beforeCode","afterCode","beforeBus","afterBus","beforeBank","afterBank","beforeBankCode","afterBankCode","contacts","contactsPhone","techzy","techH","techM","techL","yingye","note","changeUnit","region","batch","beforeLevel","beforeNature","beforeType","beforeLicenseKey","afterLevel","afterNature","afterType","afterLicenseKey"]},r=[{id:"in_01",title:"南关区"},{id:"in_02",title:"朝阳区"},{id:"in_03",title:"二道区"},{id:"in_04",title:"绿园区"},{id:"in_05",title:"高新区"},{id:"in_06",title:"宽城区"},{id:"in_07",title:"汽车经济开发区"},{id:"in_08",title:"经济开发区"},{id:"in_09",title:"净月经济开发区"},{id:"in_10",title:"净月高新技术产业开发区"},{id:"in_11",title:"北湖经济开发区"},{id:"out_01",title:"双阳"},{id:"out_02",title:"德惠"},{id:"out_03",title:"九台"},{id:"out_04",title:"农安"},{id:"out_05",title:"榆树"},{id:"out_06",title:"公主岭"}];function i(e,t){let a=t;switch(e){case"timeLimit":a=function(e){const t=e.split(","),a=new Date(t[0]),n=new Date(t[1]),s=a.getFullYear(),r=a.getMonth()+1,i=a.getDate(),l=n.getFullYear(),u=n.getMonth()+1,c=n.getDate();return`${s}-${o(r)}-${o(i)} 至 ${l}-${o(u)}-${o(c)}`}(t);break;case"Region":console.log(t),a=r.find((e=>e.id===t)).title;break;case"setDate":a=function(e){const t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,s=t.getDate();return`${a}-${o(n)}-${o(s)}`}(t)}return a}function o(e){return e>10?e:"0"+e}function l(e){if(!e)return;let t=[];const a=e.split(",");return a.indexOf("name")>=0&&t.push("名称"),a.indexOf("address")>=0&&t.push("地址"),a.indexOf("member")>=0&&t.push("法人"),a.indexOf("bank")>=0&&t.push("账户"),t.toString()}function u(e,t){t.addPage();const a=n.readdirSync(e).filter((e=>e.indexOf("jpg")>=0));for(let n=0;n<a.length;n++){const s=a[n].split(".")[0];t.font(`${process.cwd()}/msyh.ttf`),t.fontSize(17).text(s.split("-")[0],200,50),t.image(`${e}/${a[n]}`,20,100,{width:570,height:600,align:"center"}),n!==a.length-1?t.addPage({margin:10,size:[610,800]}):t.end()}}e.exports=function(e,t,a,r,o,c){(new Date).getTime();const d={};"insert"===e?s[t].map(((e,a)=>{const n=s[t][a];d[n]=i(n,r[a])})):"change"===e&&s[e].map(((t,a)=>{const n=s[e][a];d[n]=i(n,r[a])})),"insert"===e&&"B"===t?function(e,t,a,s,r,i,o,l){n.existsSync(`${l}/pdfs`)||n.mkdirSync(`${l}/pdfs`),s.pipe(n.createWriteStream(`${l}/pdfs/${r.name}.pdf`)),s.font(`${process.cwd()}/msyh.ttf`),s.moveTo(e,t).fontSize(15).text("长春市医疗保险定点零售药店签约申请表",180,50);for(let n=0;n<14;n++)s.lineTo(570,t+a*n).moveTo(e,t+a*(n+1));s.moveTo(e,t).lineTo(e,714).moveTo(570,t).lineTo(570,714),s.moveTo(180,t).lineTo(180,714),s.moveTo(310,282).lineTo(310,618),s.moveTo(420,282).lineTo(420,618),s.moveTo(230,618).lineTo(230,666),s.moveTo(300,618).lineTo(300,666),s.moveTo(370,618).lineTo(370,666),s.moveTo(440,618).lineTo(440,666),s.moveTo(510,618).lineTo(510,666),s.stroke(),function(e,t,a,n,s,r,i,o,l){i.fontSize(14).text("申请单位名称",e,s).text(o.name,t,s),i.text("注册地址",e,158).text(o.address,t,158),i.text("定位地址",e,206).text(o.locationAddress,t,206),i.text("统一社会信用代码",e,254).text(o.creditCode,t,254),i.text("药品经营许可证号",e,302).text(o.business,t,302).text("药品经营许可证",315,287).text("有效期限",340,302).text(o.timeLimit,n,287),i.text("所属区域",e,345).text(o.Region,t,350).text("营业时间",a,345).text(o.yingYeTime,n,350),i.text("医疗保险情况",e,398).text(o.insurance,t,398).text("成立时间",a,398).text(o.setDate,n,398),i.text("经营方式",e,446).text(o.practice,t,446).text("营业面积",a,446).text(o.area,n,446),i.text("药店等级",e,494).text(o.level,t,494).text("驻店药师",a,494).text(o.pharmacist,n,494),i.text("法人代表",e,542).text(o.member,t,542).text("联系电话",a,542).text(o.memberTel,n,542),i.text("医保负责人",e,590).text(o.ybCharge,t,590).text("联系电话",a,590).text(o.ybChargeTel,n,590),i.text("药学及时人员数",e,638).text("高级",t,638).text(o.techH+"人",265,638).text("中级",330,638).text(o.techM+"人",410,638).text("低级",465,638).text(o.techL+"人",540,638),i.text("营业人员",e,686).text(o.yingyeNum+"人",t,686),i.stroke(),u(l,i)}(60,190,330,440,110,0,s,r,o)}(50,90,48,a,d,0,o,c):"insert"===e&&"A"===t?function(e,t,a,s,r,i,o,l){n.existsSync(`${l}/pdfs`)||n.mkdirSync(`${l}/pdfs`),s.pipe(n.createWriteStream(`${l}/pdfs/${r.name}.pdf`)),s.font(`${process.cwd()}/msyh.ttf`),s.moveTo(e,t).fontSize(15).text("长春市医疗保险定点医疗机构签约申请表",180,50);for(let n=0;n<17;n++)s.lineTo(570,t+a*n).moveTo(e,t+a*(n+1));s.moveTo(e,t).lineTo(e,730).moveTo(570,t).lineTo(570,730),s.moveTo(180,t).lineTo(180,730),s.moveTo(310,210).lineTo(310,730),s.moveTo(420,210).lineTo(420,730),s.moveTo(230,610).lineTo(230,730),s.moveTo(360,610).lineTo(360,730),s.moveTo(470,610).lineTo(470,730),s.stroke(),function(e,t,a,n,s,r,i,o,l){i.fontSize(14).text("申请单位名称",e,s).text(o.name,t,s),i.text("注册地址",e,140).text(o.address,t,140),i.text("定位地址",e,180).text(o.locationAddress,t,180),i.text("统一社会信用代码",e,220).text(o.creditCode,t,220).text("医疗机构等级",a,220).text(o.level,n,245),i.text("机构许可证注册号",e,260).text(o.licenseKey,t,260).text("医疗机构类别",a,260).text(o.type,n,260),i.text("医疗机构许可证",e,295).text("有效期限",80,310).text(o.timeLimit.slice(0,10),200,295).text(o.timeLimit.slice(10,23),t,310).text("执业许可证",a,295).text("全国唯一标识码",315,310).text(o.onlyCode,n,300),i.text("所属区域",e,340).text(o.Region,t,340).text("成立时间",a,340).text(o.setDate,n,340),i.text("所有制形式",e,380).text(o.ownship,t,380).text("经营性质",a,380).text(o.nature,n,380),i.text("医疗用房面积",e,420).text(o.area,t,420).text("科室数量",a,420).text(o.officeNum,n,420),i.text("床位数量",e,460).text(o.bedNum,t,460).text("牙椅数量",a,460).text(o.onemoNum,n,460),i.text("职工医疗保险情况",e,500).text(o.insurance,t,500).text("营业时间",a,500).text(`${o.beginTime}-${o.endTime}`,n,500),i.text("法人代表",e,540).text(o.member,t,540).text("法人联系电话",a,540).text(o.memberTel,n,540),i.text("医保负责人",e,580).text(o.ybCharge,t,580).text("联系电话",a,580).text(o.ybChargeTel,n,580),i.text("医生",e,620).text("高级",t,620).text(o.dockerH+"人",265,620).text("中级",330,620).text(o.dockerM+"人",380,620).text("低级",430,620).text(o.dockerL+"人",510,620),i.text("护士",e,660).text("高级",t,660).text(o.nurseH+"人",265,660).text("中级",330,660).text(o.nurseM+"人",380,660).text("低级",430,660).text(o.nurseL+"人",510,660),i.text("医技人员",e,700).text("高级",t,700).text(o.meTechH+"人",265,700).text("中级",330,700).text(o.meTechM+"人",380,700).text("低级",430,700).text(o.meTechL+"人",510,700),i.stroke(),u(l,i)}(60,190,330,440,100,0,s,r,o)}(50,90,40,a,d,0,o,c):"change"===e&&"B"===t?function(e,t,a,s,r,i,o,c,d){n.existsSync(`${d}/pdfs`)||n.mkdirSync(`${d}/pdfs`),r.pipe(n.createWriteStream(`${d}/pdfs/${i.beforeName}.pdf`)),r.font(`${process.cwd()}/msyh.ttf`),r.moveTo(e,t).fontSize(15).text("长春市医疗保险定点零售药店变更签约申请表",160,50);for(let n=0;n<12;n++)r.lineTo(570,t+a*n).moveTo(e,t+a*(n+1));r.moveTo(e,527.5).lineTo(570,527.5),r.moveTo(e,630).lineTo(570,630),r.moveTo(e,750).lineTo(570,750),r.moveTo(e,t).lineTo(e,750).moveTo(570,t).lineTo(570,750),r.moveTo(180,t).lineTo(180,750),r.moveTo(380,t).lineTo(380,405),r.stroke(),function(e,t,a,n,s,r,i,o,c){i.fontSize(14).text("项目",e,n).text("变更前",260,n).text("变更后",450,n),i.text("单位名称",e,135).text(o.beforeName.slice(0,13),t,125).text(o.beforeName.slice(13,o.beforeName.length),t,140).text(o.afterName,a,135),i.text("法人代表",e,170).text(o.beforeMember,t,170).text(o.afterMember,a,170),i.text("单位地址",e,205).text(o.beforeAddress,t,205).text(o.afterAddress,a,205),i.text("营业面积",e,240).text(o.beforeArea,t,240).text(o.afterArea,a,240),i.text("营业执照注册号",e,270).text(o.beforeCode,t,275).text(o.afterCode,a,275),i.text("药品经营许可证号",e,310).text(o.beforeBus,t,310).text(o.afterBus,a,310),i.text("开户银行",e,345).text(o.beforeBank,t,345).text(o.afterBank,a,345),i.text("账号",e,380).text(o.beforeBankCode,t,380).text(o.afterBankCode,a,380),i.text("联系人及电话",e,415).text(`${o.contacts}，${o.contactsPhone}`,t,415),i.text("变更事项",e,450).text(l(o.changeUnit),t,450),i.text("人员构成",e,495).text(`执业药师${o.techzy}人，高级${o.techH}人，中级${o.techM}人，低级${o.techL}人，`,t,485),i.text("变更原因",e,570).text(o.note,t,570),i.text("审核意见",e,690),i.stroke(),u(c,i)}(60,190,400,100,0,0,r,i,c)}(50,90,35,0,a,d,0,o,c):"change"===e&&"A"===t&&function(e,t,a,s,r,i,o,c,d){n.existsSync(`${d}/pdfs`)||n.mkdirSync(`${d}/pdfs`),r.pipe(n.createWriteStream(`${d}/pdfs/${i.beforeName}.pdf`)),r.font(`${process.cwd()}/msyh.ttf`),r.moveTo(e,t).fontSize(15).text("长春市医疗保险定点医疗机构变更申请表",180,50);for(let n=0;n<13;n++)r.lineTo(570,t+a*n).moveTo(e,t+a*(n+1));r.moveTo(e,630).lineTo(570,630),r.moveTo(e,750).lineTo(570,750),r.moveTo(e,t).lineTo(e,750).moveTo(570,t).lineTo(570,750),r.moveTo(180,t).lineTo(180,750),r.moveTo(380,t).lineTo(380,440),r.stroke(),function(e,t,a,n,s,r,i,o,c){i.fontSize(14).text("项目",e,n).text("变更前",260,n).text("变更后",450,n),i.text("单位名称",e,135).text(o.beforeName.slice(0,13),t,125).text(o.beforeName.slice(13,o.beforeName.length),t,140).text(o.afterName,a,135),i.text("法人代表",e,170).text(o.beforeMember,t,170).text(o.afterMember,a,170),i.text("单位地址",e,205).text(o.beforeAddress,t,205).text(o.afterAddress,a,205),i.text("医院等级",e,240).text(o.beforeArea,t,240).text(o.afterArea,a,240),i.text("经营性质",e,270).text(o.beforeCode,t,275).text(o.afterCode,a,275),i.text("医疗机构类别",e,310).text(o.beforeBus,t,310).text(o.afterBus,a,310),i.text("执业许可证号",e,345).text(o.beforeBank,t,345).text(o.afterBank,a,345),i.text("开户银行",e,380).text(o.beforeBank,t,380).text(o.afterBank,a,380),i.text("账号",e,415).text(o.beforeBankCode,t,415).text(o.afterBankCode,a,415),i.text("联系人及电话",e,450).text(`${o.contacts}，${o.contactsPhone}`,t,450),i.text("变更事项",e,485).text(l(o.changeUnit),t,485),i.text("变更原因",e,560).text(o.note,t,560),i.text("审核意见",e,680),i.stroke(),u(c,i)}(60,190,400,100,0,0,r,i,c)}(50,90,35,0,a,d,0,o,c)}},8958:(e,t,a)=>{const n=a(5747),s=a(6306),r={xukez:"医疗机构执业许可证",yingye:"营业执照",zhiye:"科室设置及医务人员的执业信息",zhidu:"与医保政策对应的内部管理制度和财务制度",cailiao:"与医保有关的信息系统相关材料",baogao:"纳入定点后对医保基金影响的预测性分析报告",jingying:"药品经营许可证或营业执照和法定代表人身份证",zige:"执业药师资格证书及其劳动合同复印件",laodong:"医保专（兼）职管理人员的劳动合同复印件",promise:"授权承诺书",idcard:"授权人身份证",zhuce:"执业药师注册证",shouyin:"收银窗口场景照片",mentou:"门头照片",fapiao:"正式运营3个月以上的佐证材料",idcard:"法人身份证",zulin:"房屋产权或租赁合同",ty1:"与特药生产厂家签署的一级经销商协议",tycl:"经营特药名单及供货商销售资格证明材料",lenglian:"冷链系统相关材料",ty4:"申请单位股权权属证明材料（药店权属证明材料）",ty5:"特药供应业务相适应的经营管理制度",ty6:"所配备的执业医师和执业药师注册信息"};async function o(e){let t=[],a=!0;return n.existsSync(e)&&(t=n.readdirSync(e),t.forEach((function(t,s){let r=e+"/"+t;n.statSync(r).isDirectory()?o(r):"docx"!==r.split(".")[1]?n.unlinkSync(r):a=!1})),a&&n.rmdirSync(e)),a}async function l(e,t,a,i,o,l,u){const c={};c.dirName=s.inputParamsVal(e),c.type=s.inputParamsVal("B"),c.batch=s.inputParamsVal(i);const d=(await s.executeProcedure("M_GET_IMGDATA",c,s.outputParamsCursor(1)))[0][0][0];var m=`${process.cwd()}/${u||"download"}/${o}/${l}/${r[t]}-${a}.jpg`,p=d.replace(/^data:image\/\w+;base64,/,""),g=new Buffer(p,"base64");return new Promise(((e,t)=>{n.writeFile(m,g,(function(t){t?console.log(t):(console.log("写入完成！！！"),e("111"))}))}))}e.exports=async function(e,t,a,s,r){for(n.existsSync(`${process.cwd()}/${r||"download"}/${e}`)||n.mkdirSync(`${process.cwd()}/${r||"download"}/${e}`),n.existsSync(`${process.cwd()}/${r||"download"}/${e}/${t}`)?await o(`${process.cwd()}/${r||"download"}/${e}/${t}`)&&n.mkdirSync(`${process.cwd()}/${r||"download"}/${e}/${t}`):n.mkdirSync(`${process.cwd()}/${r||"download"}/${e}/${t}`),i=0;i<s.length;i++){const n=s[i];await l(n.fileId,n.fileUnit,n.fileNo,a,e,t,r)}return`${process.cwd()}/${r||"download"}/${e}`}},5172:(e,t,a)=>{const n=a(2336),s=a(6734),r=a(5747),i=(a(5622),{A:["creditCode","name","address","Region","member","type","level","ownship","nature","officeNum","bedNum","onemoNum","area","ybCharge","ybChargeTel","setDate","licenseKey","insurance","dockerH","dockerM","dockerL","nurseH","nurseM","nurseL","meTechH","meTechM","meTechL","applyDate","locationAddress","memberTel","timeLimit","onlyCode","yingYeTime"],B:["creditCode","name","address","Region","member","practice","area","ybCharge","ybChargeTel","business","setDate","level","pharmacist","insurance","techH","techM","techL","yingyeNum","applyDate","locationAddress","lat","lng","memberTel","timeLimit","yingYeTime"]}),o=["id","befName","aftName","befMember","aftMember","befAddress","aftAddress","befArea","aftArea","befCode","aftCode","befBus","aftBus","befBank","aftBank","befBankCode","aftBankCode","contacts","contactPhone","techZy","techH","techM","techL","yingyeNum","note","unit","befLevel","befNature","befType","befLicense","aftLevel","aftNature","aftType","aftLicense"],l={insert:{A:"medical.docx",B:"drug.docx",C:"ltc.docx"},change:{A:"change-medical.docx",B:"change-drug.docx"}},u=[{id:"in_01",title:"南关区"},{id:"in_02",title:"朝阳区"},{id:"in_03",title:"二道区"},{id:"in_04",title:"绿园区"},{id:"in_05",title:"高新区"},{id:"in_06",title:"宽城区"},{id:"in_07",title:"汽车经济开发区"},{id:"in_08",title:"经济开发区"},{id:"in_09",title:"净月经济开发区"},{id:"in_10",title:"净月高新技术产业开发区"},{id:"in_11",title:"北湖经济开发区"},{id:"out_01",title:"双阳"},{id:"out_02",title:"德惠"},{id:"out_03",title:"九台"},{id:"out_04",title:"农安"},{id:"out_05",title:"榆树"},{id:"out_06",title:"公主岭"}];function c(e){return e>10?e:"0"+e}function d(e){let t=[];r.existsSync(e)&&(t=r.readdirSync(e),console.log(t),t.forEach((function(t,a){let n=e+"/"+t;r.statSync(n).isDirectory()?d(n):(console.log(`删除文件${n}`),r.unlinkSync(n))})),r.rmdirSync(e))}e.exports=async function(e,t,a,m,p,g,P){r.existsSync(`${process.cwd()}/${P||"download"}/${a}`)||r.mkdirSync(`${process.cwd()}/${P||"download"}/${a}`),r.existsSync(`${process.cwd()}/${P||"download"}/${a}/${m}`)?(d(`${process.cwd()}/${P||"download"}/${a}/${m}`),r.mkdirSync(`${process.cwd()}/${P||"download"}/${a}/${m}`)):r.mkdirSync(`${process.cwd()}/${P||"download"}/${a}/${m}`);const h=r.readFileSync(`${process.cwd()}/templates/${l[t][e]}`,"binary"),f=new n(h),b=new s;b.loadZip(f);const V={},y="insert"===t?i[e]:o;y.map(((e,t)=>{const a=y[t];V[a]=function(e,t){let a=t;switch(e){case"timeLimit":a=function(e){const t=e.split(","),a=new Date(t[0]),n=new Date(t[1]),s=a.getFullYear(),r=a.getMonth()+1,i=a.getDate(),o=n.getFullYear(),l=n.getMonth()+1,u=n.getDate();return`${s}-${c(r)}-${c(i)} 至 ${o}-${c(l)}-${c(u)}`}(t);break;case"Region":a=u.find((e=>e.id===t)).title;break;case"setDate":a=function(e){const t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,s=t.getDate();return`${a}-${c(n)}-${c(s)}`}(t);break;case"unit":a=function(e){if(!e)return;let t=[];const a=e.split(",");return a.indexOf("name")>=0&&t.push("名称"),a.indexOf("address")>=0&&t.push("地址"),a.indexOf("member")>=0&&t.push("法人"),a.indexOf("bank")>=0&&t.push("账户"),t.toString()}(t)}return a}(a,g[t])}));const C=g.length;V.yingYeTime=`${g[C-3]} - ${g[C-2]}`,b.setData(V);try{b.render()}catch(e){console.log(e)}const T=b.getZip().generate({type:"nodebuffer"});return r.writeFileSync(`${process.cwd()}/${P||"download"}/${a}/${m}/${p}.docx`,T,(e=>{console.log(e)})),`${process.cwd()}/${P||"download"}/${a}/${m}/${p}.docx`}},6709:(e,t,a)=>{const n=a(434);function s(e,t,a,s){return new Promise(((r,i)=>{let o={headers:s&&s.headers?s.headers:{"Content-Type":"application/json"},url:t,method:e,body:"object"==typeof a?JSON.stringify(a):a,timeout:3e4};s&&"boolean"==typeof s.isUseProxy&&!0===s.isUseProxy&&(o.proxy="http://10.199.17.70:30001"),n(o,((e,a,n)=>{e?i(`http request error: ${e}| ${t}`):e||200!==a.statusCode?i(`http request error: statusCode is ${a.statusCode}| ${t}`):r({statusCode:a.statusCode,body:n})}))}))}a(5747),e.exports={postRequest:(e,t,a)=>s("POST",e,t,a),getRequest:(e,t,a)=>s("GET",e,t,a),getParameter:e=>e.query,postParameter:e=>e.body}},2791:e=>{e.exports={id:530281779,name:"2021定点医疗机构",children:[{id:530811118,name:"医院",children:[]},{id:530705194,name:"长护险",children:[]},{id:531007043,name:"门诊",children:[]},{id:531050028,name:"药店",children:[{id:530679812,name:"连锁",children:[{id:530476988,name:"同仁大药房",children:[{id:530813592,name:"法人",children:[]},{id:530881520,name:"医保负责人",children:[]},{id:530688899,name:"门店",children:[]}]},{id:530789884,name:"国大益和大药房",children:[{id:531133012,name:"法人",children:[]},{id:531020176,name:"医保负责人",children:[]},{id:531053084,name:"门店",children:[]}]},{id:531076190,name:"吉林大药房",children:[{id:531098043,name:"法人",children:[]},{id:531002149,name:"医保负责人",children:[]},{id:530910497,name:"门店",children:[]}]},{id:530906501,name:"禹成药房",children:[{id:530711572,name:"法人",children:[]},{id:531047018,name:"医保负责人",children:[]},{id:530391961,name:"门店",children:[]}]},{id:531007140,name:"恒爱大药房",children:[{id:531024326,name:"法人",children:[]},{id:530598739,name:"医保负责人",children:[]},{id:530926438,name:"门店",children:[]}]},{id:530749527,name:"天翼大药房",children:[{id:531090115,name:"法人",children:[]},{id:530470865,name:"医保负责人",children:[]},{id:530931685,name:"门店",children:[]}]},{id:530483788,name:"修正堂药房",children:[{id:530496639,name:"法人",children:[]},{id:530740745,name:"医保负责人",children:[]},{id:531097034,name:"门店",children:[]}]},{id:530851635,name:"同康大药房",children:[{id:530604716,name:"法人",children:[]},{id:531030075,name:"医保负责人",children:[]},{id:531012116,name:"门店",children:[]}]},{id:531149006,name:"永新堂大药房",children:[{id:530964382,name:"法人",children:[]},{id:530978278,name:"医保负责人",children:[]},{id:530894565,name:"门店",children:[]}]},{id:530931686,name:"敖东大药房",children:[{id:530833441,name:"法人",children:[]},{id:531144023,name:"医保负责人",children:[]},{id:530930392,name:"门店",children:[]}]},{id:530839435,name:"福百草大药房",children:[{id:530714674,name:"法人",children:[]},{id:530391962,name:"医保负责人",children:[]},{id:531128023,name:"门店",children:[]}]},{id:531093136,name:"正开医药",children:[{id:531033192,name:"法人",children:[]},{id:531067132,name:"医保负责人",children:[]},{id:531016142,name:"门店",children:[]}]},{id:530935285,name:"义善堂大药房",children:[{id:530404666,name:"法人",children:[]},{id:530756685,name:"医保负责人",children:[]},{id:530593795,name:"门店",children:[]}]},{id:530714675,name:"房联医药",children:[{id:531045187,name:"法人",children:[]},{id:530998147,name:"医保负责人",children:[]},{id:530913506,name:"门店",children:[]}]}]},{id:530585713,name:"单体",children:[]}]}]}},6172:(e,t,a)=>{const n=a(4271),s=a(6709);e.exports=async function(e,t,a,r){const i={A:{A:"审核未通过",C:"初审未通过，请返回审核进度查询进行修改",D:"初审已通过，正在等待复审",DR:"二次申报已通过，正在等待复审",E:"复审未通过，请返回审核进度查询进行修改",F:"您申请单位已经通过复审，请于公告时间之内将评估材料并携带公章送达至长春市社会医疗保险管理局【天富路-新城大街交汇->诺瑞德广场->市医保医药监督处】(外六县送至当地医保经办)"},B:{A:"审核未通过",C:"初审未通过，请返回审核进度查询进行修改",D:"初审已通过，正在等待复审",DR:"二次申报已通过，正在等待复审",E:"复审未通过，请返回审核进度查询进行修改",F:"您申请单位已经通过复审，请于公告时间之内将评估材料并携带公章送达至长春市社会医疗保险管理局【天富路-新城大街交汇->诺瑞德广场->市医保医药监督处】(外六县送至当地医保经办)"},C:{C:"医保联系人认证审核未通过",D:"您已通过医保联系人认证，可登录系统进行业务办理",DR:"二次申报已通过，可登录系统进行业务办理"}},o=(await n.select("pub_user_info",{unionid:e,channel:"wechat_official"}))[0].openid;console.log(o),n.select("sysParams",{key:"access_token"}).then((e=>{let n={openid:o,first:"",keyword1:"两定机构系统通知",keyword2:"申报进度提示",remark:`您申报的  [${a}]  [${"C"===t?"医保联系人认证":"医药机构申报"}]，${i[t][r]}`,redirect:""};console.log(n),async function(e,t){const a={touser:e.openid,template_id:"UWXdRyDS8qjsDKTOjvuKjvmURvKqaRHE_69lfBuvoI8",url:"https://mp.weixin.qq.com/insurance/card/creditjump?cityid=220100&from=t-oH1Or55jHNtGmA9Ec9nA.%3D#wechat_redirect",data:{first:{value:e.first,color:"#173177"},keyword1:{value:e.keyword1,color:"#173177"},keyword2:{value:e.keyword2,color:"#173177"},remark:{value:e.remark,color:"#173177"}}};return await async function(e,t){const a="https://api.weixin.qq.com/cgi-bin/message/template/send?access_token="+t;return await async function(e,t,a){try{const a=await s.postRequest(e,t,{isUseProxy:!0}),n=JSON.parse(a.body);if(40001===n.errcode||42001===n.errcode)throw n.errcode+"|"+n.errmsg;if(0===n.errcode)return"公众号消息提醒发送成功";if(43004===n.errcode)return{status:43004,msg:n.errmsg};throw`错误代码:${n.errcode}|${n.errmsg}`}catch(e){console.log(e)}}(a,e)}(a,t)}(n,e[0].value).then().catch()}))}},9659:(e,t,a)=>{const n=a(5747),s=a(5622),r=a(5543),i=a(7353),o=a(5172),l=a(8958),u=a(2189),c=a(6306),d=a(3863);let m=[];async function p(e,t,a,n,r,i){const u={};u.creditCode=c.inputParamsVal(e),u.quarter=c.inputParamsVal(r),u.type=c.inputParamsVal(t),u.affairs=c.inputParamsVal(a);const d=await c.executeProcedure("M_GET_DOWNINFO",u,c.outputParamsCursor(2));return new Promise((async(e,u)=>{await o(t,a,n,d[0][0][1],`${d[0][0][1]}申请表`,d[0][0],i);const c=[];d[1].map((e=>{c.push({fileId:e[0],fileUnit:e[1],fileNo:e[2]})}));const p=await l(n,d[0][0][1],r,c,i);m.push(p),e({affairs:a,type:t,info:d[0][0],pdfPath:p,imgPath:s.join(p,d[0][0][1])})}))}const g={zipDownload:async function(e,t){m=[];const a=(new Date).getTime()+"",s=e.query,o=JSON.parse(s.params);for(let e=0;e<o.length;e++){const t=new d,n=await p(o[e][0],o[e][1],o[e][2],a,s.quarter);await u(n.affairs,n.type,t,n.info,n.imgPath,n.pdfPath)}!function(e,t){let a=n.createWriteStream(process.cwd()+"/package.zip"),s=r("zip",{zlib:{level:9}});a.on("close",(function(){console.log(`总共 ${s.pointer()} 字节`),console.log("archiver完成文件的归档，文件输出流描述符已关闭"),setTimeout((()=>{let t=process.cwd()+"/package.zip",a=n.statSync(t).size,s=n.createReadStream(t);e.writeHead(200,{"Content-Type":"application/force-download","Content-Disposition":"attachment; filename="+i("package.zip"),"Content-Length":a}),s.pipe(e)}),2e3)})),a.on("end",(function(){console.log("数据源已耗尽")})),s.on("warning",(function(e){if("ENOENT"!==e.code)throw e;console.warn("stat故障和其他非阻塞错误")})),s.on("error",(function(e){throw e})),s.pipe(a),s.directory(t,"package"),s.finalize()}(t,m[0])},filrBackUp:async function(e,t,a,n,s){const r=new d,i=await p(e,t,a,n,n,s);await u(i.affairs,i.type,r,i.info,i.imgPath,i.pdfPath)}};e.exports=g},5543:e=>{"use strict";e.exports=require("archiver")},2473:e=>{"use strict";e.exports=require("body-parser")},8563:e=>{"use strict";e.exports=require("colors")},8328:e=>{"use strict";e.exports=require("connect-mongo")},358:e=>{"use strict";e.exports=require("cookie-parser")},479:e=>{"use strict";e.exports=require("cors")},3682:e=>{"use strict";e.exports=require("debug")},6734:e=>{"use strict";e.exports=require("docxtemplater")},2127:e=>{"use strict";e.exports=require("express")},5057:e=>{"use strict";e.exports=require("express-session")},5747:e=>{"use strict";e.exports=require("fs")},6725:e=>{"use strict";e.exports=require("helmet")},8605:e=>{"use strict";e.exports=require("http")},9953:e=>{"use strict";e.exports=require("iconv-lite")},204:e=>{"use strict";e.exports=require("md5")},1671:e=>{"use strict";e.exports=require("mime-types")},7548:e=>{"use strict";e.exports=require("mongodb")},5619:e=>{"use strict";e.exports=require("mongoose")},8633:e=>{"use strict";e.exports=require("multer")},366:e=>{"use strict";e.exports=require("mysql")},1631:e=>{"use strict";e.exports=require("net")},6297:e=>{"use strict";e.exports=require("nodejs-websocket")},8054:e=>{"use strict";e.exports=require("oracledb")},5622:e=>{"use strict";e.exports=require("path")},3863:e=>{"use strict";e.exports=require("pdfkit")},2336:e=>{"use strict";e.exports=require("pizzip")},3908:e=>{"use strict";e.exports=require("promise")},434:e=>{"use strict";e.exports=require("request")},7353:e=>{"use strict";e.exports=require("urlencode")},1231:e=>{"use strict";e.exports=require("uuid")}},t={};function a(n){if(t[n])return t[n].exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{a(8563),a(3682)("express:sdr")("Application booting");const e=a(3876),t=e.nodeServer.port,n=e.nodeServer.address;try{a(4151).then((function(){a(8605).createServer(a(4279)).listen(t,n).on("error",(e=>{throw e})).on("listening",(()=>{console.log("APP has been started successfully!"),console.log("Listening on "+t)})).on("exit",(()=>{console.log("On exit!!!")}))}))}catch(e){console.log(e)}})()})();